<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SpinToolBox: D:/Sylvain/Instru/SpinToolBox V2.6/src/plugins/SDevice/SDevicePSAE4440A/SDevicePSAE4440A.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../compass64.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SpinToolBox&#160;<span id="projectnumber">2.6</span></div>
   <div id="projectbrief">Automatize the measurement process in the characterization of the magnetic tunnel junction</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>D:/Sylvain/Instru/SpinToolBox V2.6/src/plugins/SDevice/SDevicePSAE4440A/SDevicePSAE4440A.cpp</h1>  </div>
</div>
<div class="contents">
<a href="../../df/d4e/_s_device_p_s_a_e4440_a_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;SDK/SError.h&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;SDKDevice/SDevice/SDeviceError.h&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;SDKDevice/SDevice/SDeviceGpib.h&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/db2/_s_device_p_s_a_e4440_a_8h.html" title="Declares the SDevicePSAE4440A class.">SDevicePSAE4440A.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;SUiCpPSAE4440A.h&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;SDK/SData/SData2D.h&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;SDK/SData/SData2DScript.h&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;QScriptable&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;QScriptValue&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;QScriptEngine&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;QStringList&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;QList&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#define GHZ 1000000000</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#define MHZ 1000000</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#define KHZ 1000</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a>00045 <span class="comment">/*****************************************************************************************************/</span>
<a name="l00046"></a>00046 <span class="comment">/*                                                SDevicePSAE4440APlugin                                       */</span>
<a name="l00047"></a>00047 <span class="comment">/*****************************************************************************************************/</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;QtCore&gt;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 Q_EXPORT_PLUGIN2(<span class="stringliteral">&quot;SDevicePSAE4440APlugin&quot;</span>, <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html" title="it is the class that manage the control panel of the Keithley k2400">SDevicePSAE4440APlugin</a>)
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html" title="it is the class that manage the control panel of the Keithley k2400">SDevicePSAE4440APlugin</a>::<a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html" title="it is the class that manage the control panel of the Keithley k2400">SDevicePSAE4440APlugin</a>():state_(2),PSAE4440A(NULL)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064 }
<a name="l00073"></a>00073 SDevicePSAE4440APlugin::~SDevicePSAE4440APlugin()
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075      <span class="keywordflow">if</span>(PSAE4440A!=NULL)
<a name="l00076"></a>00076           <span class="keyword">delete</span> PSAE4440A;
<a name="l00077"></a>00077 }
<a name="l00088"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a1b1a0af01975af8a537481ad8b233331">00088</a> <span class="keywordtype">bool</span> <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a1b1a0af01975af8a537481ad8b233331" title="initialize the plugin">SDevicePSAE4440APlugin::load</a>()
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090      <span class="comment">//GlobalMetaDataMap_ = GlobalMetaDataMap;</span>
<a name="l00091"></a>00091      PSAE4440A = <span class="keyword">new</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html" title="Provides control of the E4440A PSA Spectrum Analyzer, 3 Hz - 26.5 GHz, Agilent.">SDevicePSAE4440A</a>(<span class="keyword">this</span>);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093      <span class="keywordflow">if</span>(PSAE4440A-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6120b6ba6e7ba29ddf260d893b4af06d" title="(SCRIPTABLE) Gets the availability.">available</a>()) state_=0;
<a name="l00094"></a>00094      <span class="keywordflow">return</span> PSAE4440A-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6120b6ba6e7ba29ddf260d893b4af06d" title="(SCRIPTABLE) Gets the availability.">available</a>();
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00107"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#aa2d7a06942ab55994dd4514dfa01e76c">00107</a> QString <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#aa2d7a06942ab55994dd4514dfa01e76c" title="return the object name of the metadata.">SDevicePSAE4440APlugin::name</a>()<span class="keyword"> const</span>
<a name="l00108"></a>00108 <span class="keyword"></span>{
<a name="l00109"></a>00109      <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;Agilent Technologies, PSA Series Spectrum Analyzer E4440A&quot;</span>);
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00122"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a5fae92b3b83484757720adcd0d36d904">00122</a> QString <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a5fae92b3b83484757720adcd0d36d904" title="return the short name of the plugin.">SDevicePSAE4440APlugin::shortName</a>()<span class="keyword"> const</span>
<a name="l00123"></a>00123 <span class="keyword"></span>{
<a name="l00124"></a>00124      <span class="keywordflow">return</span> QString(SDEVICEPSAE4440A_SHORT_NAME);
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00137"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a7083d8bd83d312b796f4a0da2b757bc0">00137</a> QString <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a7083d8bd83d312b796f4a0da2b757bc0" title="return the description of the plugin">SDevicePSAE4440APlugin::description</a>()<span class="keyword"> const</span>
<a name="l00138"></a>00138 <span class="keyword"></span>{
<a name="l00139"></a>00139      QString des    =  <span class="stringliteral">&quot;The Agilent E4440A PSA high-performance spectrum analyzer measures and monitors complex RF and&quot;</span>;
<a name="l00140"></a>00140      des  += <span class="stringliteral">&quot;microwave signals up to 26.5 GHz. With optional external mixing, the frequency coverage expands&quot;</span>;
<a name="l00141"></a>00141      des  += <span class="stringliteral">&quot;to 110 GHz by Agilent external mixer, and to 325 GHz by other vendors&#39; mixer.&quot;</span>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143      <span class="keywordflow">return</span> des;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00157"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#aa1e6a8a4ea7f06f617782bd3a3fa22b8">00157</a> <span class="keywordtype">bool</span> <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#aa1e6a8a4ea7f06f617782bd3a3fa22b8" title="add (or not) some functions to the script engine">SDevicePSAE4440APlugin::scriptable</a>( QScriptEngine * engine )
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159      <span class="keyword">static</span> <span class="keywordtype">bool</span> initialized = <span class="keyword">false</span>;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161      <span class="keywordflow">if</span>(!initialized){ <span class="comment">// evite le multi initialitation</span>
<a name="l00162"></a>00162           <span class="keywordflow">try</span>{
<a name="l00163"></a>00163                initialized = <span class="keyword">true</span>;
<a name="l00164"></a>00164                <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html" title="Provides control of the E4440A PSA Spectrum Analyzer, 3 Hz - 26.5 GHz, Agilent.">SDevicePSAE4440A</a>*   PSAE4440A = <span class="keyword">new</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html" title="Provides control of the E4440A PSA Spectrum Analyzer, 3 Hz - 26.5 GHz, Agilent.">SDevicePSAE4440A</a>();
<a name="l00165"></a>00165 
<a name="l00166"></a>00166                QScriptValue qsvSDevicePSAE4440A = engine-&gt;newQObject(PSAE4440A,QScriptEngine::ScriptOwnership);
<a name="l00167"></a>00167                engine-&gt;globalObject().setProperty(<span class="stringliteral">&quot;PSAE4440A&quot;</span>, qsvSDevicePSAE4440A);
<a name="l00168"></a>00168                engine-&gt;evaluate(<span class="stringliteral">&quot;PSAE4440A.ReadSpectrum = PSAE4440A.qsReadSpectrum;\n&quot;</span>,<span class="stringliteral">&quot;Initialization&quot;</span>);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170           }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00171"></a>00171 
<a name="l00172"></a>00172                initialized = <span class="keyword">false</span>;
<a name="l00173"></a>00173                engine-&gt;evaluate(<span class="stringliteral">&quot;var PSAE4440A = new Object(); PSAE4440A.available = false;&quot;</span>,<span class="stringliteral">&quot;Initialization&quot;</span>);
<a name="l00174"></a>00174                qDebug()  &lt;&lt;<span class="stringliteral">&quot; ERROR (LOW): initialization of the Agilent PSAE4440A&#39;s script object failed&quot;</span> 
<a name="l00175"></a>00175                     &lt;&lt; error;
<a name="l00176"></a>00176                <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178           }
<a name="l00179"></a>00179      }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00194"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#ab42d15e8ccb8a67a8c23c5fc0d3e0ee4">00194</a> <span class="keywordtype">bool</span> <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#ab42d15e8ccb8a67a8c23c5fc0d3e0ee4" title="does the plugin add some function to the script engine">SDevicePSAE4440APlugin::isScriptable</a>()
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00209"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#acfed328565220dca68e81cf8551868ca">00209</a> <span class="keywordtype">bool</span> <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#acfed328565220dca68e81cf8551868ca" title="does the plugin add a tab to the control panel to the script engine">SDevicePSAE4440APlugin::isControlPanel</a>()
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00228"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a3bcb43eef82d9c59273ffdd6a10cb908">00228</a> QWidget * <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a3bcb43eef82d9c59273ffdd6a10cb908" title="add (or not) a tab to the control panel">SDevicePSAE4440APlugin::controlPanel</a>(QWidget * parent <span class="comment">/*= NULL*/</span>)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230 
<a name="l00231"></a>00231      QWidget * CtrlPanel = <span class="keyword">new</span> SUiCpPSAE4440A(parent);
<a name="l00232"></a>00232      <span class="keywordflow">return</span> CtrlPanel;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00246"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a3b54601c82c052eee3ef8a0107b4eeb3">00246</a> <span class="keywordtype">bool</span> <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a3b54601c82c052eee3ef8a0107b4eeb3" title="(virtual pure) does the plugin have a setting window ?">SDevicePSAE4440APlugin::isSetting</a>()
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248      <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00265"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#ace6dde8b2083f68c2f9cfbedd1f9e996">00265</a> QWidget * <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#ace6dde8b2083f68c2f9cfbedd1f9e996" title="(virtual pure) give (or not) a setting window.">SDevicePSAE4440APlugin::setting</a>(QWidget * parrent <span class="comment">/*= NULL*/</span> )
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267      QWidget * widSetting = <span class="keyword">new</span> QWidget(parrent); 
<a name="l00268"></a>00268      <span class="keywordflow">return</span> widSetting;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00282"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#aa074953cc9a86e1576f46bf037b01d2a">00282</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#aa074953cc9a86e1576f46bf037b01d2a" title="shutdown the plugin (by example before closing the application)">SDevicePSAE4440APlugin::shutdown</a>()
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284      <span class="comment">//PSAE4440A-&gt;deactivate();</span>
<a name="l00285"></a>00285      state_=2;
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00298"></a>00298 <span class="keywordtype">int</span> SDevicePSAE4440APlugin::state()
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300      <span class="keywordflow">return</span> state_;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00313"></a>00313 <span class="keywordtype">bool</span> SDevicePSAE4440APlugin::available()
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315      <span class="keywordflow">return</span> PSAE4440A-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6120b6ba6e7ba29ddf260d893b4af06d" title="(SCRIPTABLE) Gets the availability.">available</a>();
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00326"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a3956786c22ff4cb73c8323489d19f9e4">00326</a> QString <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a3956786c22ff4cb73c8323489d19f9e4" title="return the version of the SDK that is needed for run the plugin">SDevicePSAE4440APlugin::plgVersion</a>()<span class="keyword"> const</span>
<a name="l00327"></a>00327 <span class="keyword"></span>{
<a name="l00328"></a>00328      <span class="keywordflow">return</span> QString::number(SDEVICEPSAE4440A_VERSION);
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00339"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a24923c94efa978d737c6af463c0b41ab">00339</a> QString <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a24923c94efa978d737c6af463c0b41ab" title="return the version of the SDK which is required for this plugin">SDevicePSAE4440APlugin::SDKVersion</a>()<span class="keyword"> const </span>
<a name="l00340"></a>00340 <span class="keyword"></span>{
<a name="l00341"></a>00341      <span class="keywordflow">return</span> QString::number(SDEVICEPSAE4440A_MAJOR_VERSION_COMPATIBILITY) + 
<a name="l00342"></a>00342           QString(<span class="stringliteral">&quot;.&quot;</span>) + QString::number(SDEVICEPSAE4440A_MINOR_VERSION_COMPATIBILITY);
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00355"></a><a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a1bd51fb692c73bd1e2c063b697427c5b">00355</a> <span class="keywordtype">bool</span> <a class="code" href="../../d1/d5b/class_s_device_p_s_a_e4440_a_plugin.html#a1bd51fb692c73bd1e2c063b697427c5b" title="this function is call when the plugin is unload">SDevicePSAE4440APlugin::unload</a>()
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357      qDebug()  &lt;&lt;<span class="stringliteral">&quot; WARNING: unloading of the Agilent PSAE4440A&#39;s script object failed \n&quot;</span> ;
<a name="l00358"></a>00358      qDebug()  &lt;&lt;<span class="stringliteral">&quot; \t because the function is not implanted yet\n&quot;</span> ;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="comment">/*****************************************************************************************************/</span>
<a name="l00366"></a>00366 <span class="comment">/*                                                SDevicePSAE4440A                                             */</span>
<a name="l00367"></a>00367 <span class="comment">/*****************************************************************************************************/</span>
<a name="l00368"></a>00368 
<a name="l00377"></a>00377 SDevicePSAE4440A::SDevicePSAE4440A(QObject *parent)  : 
<a name="l00378"></a>00378  metaDataOnOff_(true) {
<a name="l00379"></a>00379 
<a name="l00380"></a>00380      init();
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00398"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a236a5bf7371123897b63bdf46864f374">00398</a> SDevicePSAE4440A::SDevicePSAE4440A(<span class="keywordtype">double</span> <span class="keyword">const</span> FreqStart, <span class="keywordtype">double</span> <span class="keyword">const</span> FreqStop, <span class="keywordtype">double</span> <span class="keyword">const</span> RBW, <span class="keywordtype">int</span> <span class="keyword">const</span> average, QObject *parent): 
<a name="l00399"></a>00399  metaDataOnOff_(true){
<a name="l00400"></a>00400 
<a name="l00401"></a>00401      <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a19e1834228769dcafe00c688aef35536" title="Initializes the PSA E4440A device.">init</a>();
<a name="l00402"></a>00402      <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6d90235d1fb16df33e06a3e68e2f3def" title="(SCRIPTABLE) Sets the start frequency.">setFreqStart</a>(FreqStart);
<a name="l00403"></a>00403      <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#afca3e5b4deca941015cd0fa6d8f0c4a1" title="(SCRIPTABLE) Sets the stop frequency.">setFreqStop</a>(FreqStop);
<a name="l00404"></a>00404      <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a17013d85cb47868a9d6b13874c6fdcf6" title="(SCRIPTABLE) Sets the resolution de Bandwith.">setRbw</a>(RBW);
<a name="l00405"></a>00405      <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a22962b7a2846b3c78921106a2b72eec4" title="(SCRIPTABLE) Sets the number of average, 0 desactivate the average.">setNbAverage</a>(average);
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00415"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a19e1834228769dcafe00c688aef35536">00415</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a19e1834228769dcafe00c688aef35536" title="Initializes the PSA E4440A device.">SDevicePSAE4440A::init</a>(<span class="keywordtype">void</span>){
<a name="l00416"></a>00416      <span class="keywordflow">try</span>{
<a name="l00417"></a>00417           <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a> =  <a class="code" href="../../d6/de0/class_s_interface_gpib.html#a9614ff671e7691a82f7d72e908473390" title="get the pointer to the singleton class">SInterfaceGpib::instance</a>();
<a name="l00418"></a>00418           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>= <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a>-&gt;<a class="code" href="../../d6/de0/class_s_interface_gpib.html#a92115b5c23365463b175cc6e31ad1297" title="Searches for the first Gpib element that has a efective name containing name.">findGpibElement</a>(QString(<span class="stringliteral">&quot;Agilent Technologies, E4440A&quot;</span>));
<a name="l00419"></a>00419 
<a name="l00420"></a>00420           <span class="keywordflow">if</span> (!(<a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>.<a class="code" href="../../de/dbf/struct_s_interface_gpib_1_1_gpib_element.html#ac49440ba674b48cf67a16b879db26892" title="Primary address.">PAD</a> ==-1)) available_ = <span class="keyword">true</span>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 
<a name="l00423"></a>00423      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00424"></a>00424           <span class="keywordflow">if</span> (!(error == SDEVICEERROR_GPIB_FINDLSTN)){
<a name="l00425"></a>00425                <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);    
<a name="l00426"></a>00426           }<span class="keywordflow">else</span>{
<a name="l00427"></a>00427 
<a name="l00428"></a>00428                this-&gt;<a class="code" href="../../de/dfb/class_s_device_gpib.html#a530c50b8f1abaffcba9bd77844f21a01" title="Sets the device unavailable.">setUnavailable</a>();
<a name="l00429"></a>00429                <span class="comment">//   qDebug() &lt;&lt; &quot;\nAgilent PSAE4440A not found.\n&quot;;</span>
<a name="l00430"></a>00430           }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432      }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434      setMetaData( <span class="stringliteral">&quot;freqStart&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;GHz&quot;</span> ,SMetaData::doublefloat );
<a name="l00435"></a>00435      setMetaData( <span class="stringliteral">&quot;freqStop&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;GHz&quot;</span> ,SMetaData::doublefloat );
<a name="l00436"></a>00436      setMetaData( <span class="stringliteral">&quot;rbw&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;GHz&quot;</span> ,SMetaData::doublefloat );
<a name="l00437"></a>00437      setMetaData( <span class="stringliteral">&quot;attenuation&quot;</span>,<span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;dB&quot;</span> ,SMetaData::doublefloat );
<a name="l00438"></a>00438      setMetaData( <span class="stringliteral">&quot;nbPoints&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;&quot;</span> ,SMetaData::doublefloat );
<a name="l00439"></a>00439      setMetaData( <span class="stringliteral">&quot;nbAverage&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span> ,<span class="stringliteral">&quot;&quot;</span>,SMetaData::doublefloat );
<a name="l00440"></a>00440      setMetaData( <span class="stringliteral">&quot;refLevel&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span> ,<span class="stringliteral">&quot;dBm&quot;</span>,SMetaData::doublefloat );
<a name="l00441"></a>00441      setMetaData( <span class="stringliteral">&quot;nbAverage&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::doublefloat );
<a name="l00442"></a>00442      setMetaData( <span class="stringliteral">&quot;available&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean );
<a name="l00443"></a>00443      setMetaData(<span class="stringliteral">&quot;LogDisplay&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span> ,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean );
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00452"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa475318219aaca48d2fcfa377fb57613">00452</a> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa475318219aaca48d2fcfa377fb57613" title="Destructor.">SDevicePSAE4440A::~SDevicePSAE4440A</a>() {
<a name="l00453"></a>00453      <span class="comment">// TODO Auto-generated destructor stub</span>
<a name="l00454"></a>00454      gmdm_.clear(SDEVICEPSAE4440A_SHORT_NAME);
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00465"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6d90235d1fb16df33e06a3e68e2f3def">00465</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6d90235d1fb16df33e06a3e68e2f3def" title="(SCRIPTABLE) Sets the start frequency.">SDevicePSAE4440A::setFreqStart</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> freq) {
<a name="l00466"></a>00466      QString cmd;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468      <span class="keywordflow">try</span>{
<a name="l00469"></a>00469           cmd = QString(<span class="stringliteral">&quot;FREQ:STAR &quot;</span>) + QString::number(freq) + QString(<span class="stringliteral">&quot; GHZ&quot;</span>);
<a name="l00470"></a>00470           setMetaData( <span class="stringliteral">&quot;freqStart&quot;</span>, freq,<span class="stringliteral">&quot;GHz&quot;</span> ,SMetaData::doublefloat );
<a name="l00471"></a>00471           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00472"></a>00472      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00473"></a>00473           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00474"></a>00474      }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00488"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a5e4e5a2ea2f68035ea4deaa8a523e5d4">00488</a> <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a5e4e5a2ea2f68035ea4deaa8a523e5d4" title="(SCRIPTABLE) Gets the start frequency.">SDevicePSAE4440A::freqStart</a>() {
<a name="l00489"></a>00489 
<a name="l00490"></a>00490      <span class="keywordflow">try</span>{
<a name="l00491"></a>00491           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;FREQ:STAR?&quot;</span>);
<a name="l00492"></a>00492           QVariant read = gpibRead(100);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00495"></a>00495                <span class="keywordtype">double</span> f = read.toDouble()/1.0E9;;
<a name="l00496"></a>00496                setMetaData( <span class="stringliteral">&quot;freqStart&quot;</span>, f,<span class="stringliteral">&quot;GHz&quot;</span> ,SMetaData::doublefloat );
<a name="l00497"></a>00497                <span class="keywordflow">return</span> f; <span class="comment">// sinon on ne peut pas convertir les nombre de la forme 0.0E0 == 0 !!</span>
<a name="l00498"></a>00498           }<span class="keywordflow">else</span>{
<a name="l00499"></a>00499                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00500"></a>00500           }
<a name="l00501"></a>00501      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00502"></a>00502           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00503"></a>00503           <span class="keywordflow">return</span> 0.0;
<a name="l00504"></a>00504      }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00517"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#afca3e5b4deca941015cd0fa6d8f0c4a1">00517</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#afca3e5b4deca941015cd0fa6d8f0c4a1" title="(SCRIPTABLE) Sets the stop frequency.">SDevicePSAE4440A::setFreqStop</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> freq) {
<a name="l00518"></a>00518 
<a name="l00519"></a>00519      QString cmd;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521      <span class="keywordflow">try</span>{
<a name="l00522"></a>00522           cmd = QString(<span class="stringliteral">&quot;FREQ:STOP &quot;</span>) + QString::number(freq) + QString(<span class="stringliteral">&quot; GHZ&quot;</span>);
<a name="l00523"></a>00523           setMetaData( <span class="stringliteral">&quot;freqStop&quot;</span>, freq,<span class="stringliteral">&quot;GHz&quot;</span> ,SMetaData::doublefloat );
<a name="l00524"></a>00524           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00525"></a>00525      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00526"></a>00526           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00527"></a>00527      }
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00537"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af6d7518f8a816a087ce3bb4cad7b5f4a">00537</a> <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af6d7518f8a816a087ce3bb4cad7b5f4a" title="(SCRIPTABLE) Gets the stop frequency.">SDevicePSAE4440A::freqStop</a>(){
<a name="l00538"></a>00538 
<a name="l00539"></a>00539      <span class="keywordflow">try</span>{
<a name="l00540"></a>00540           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;FREQ:STOP?&quot;</span>);
<a name="l00541"></a>00541           QVariant read = gpibRead(100);
<a name="l00542"></a>00542 
<a name="l00543"></a>00543           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00544"></a>00544                <span class="keywordtype">double</span> f = read.toDouble()/1.0E9;;
<a name="l00545"></a>00545                setMetaData( <span class="stringliteral">&quot;freqStop&quot;</span>, f ,<span class="stringliteral">&quot;GHz&quot;</span>,SMetaData::doublefloat );
<a name="l00546"></a>00546                <span class="keywordflow">return</span> f; <span class="comment">// sinon on ne peut pas convertir les nombre de la forme 0.0E0 == 0 !!</span>
<a name="l00547"></a>00547           }<span class="keywordflow">else</span>{
<a name="l00548"></a>00548                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00549"></a>00549           }
<a name="l00550"></a>00550      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00551"></a>00551           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00552"></a>00552           <span class="keywordflow">return</span> 0.0;
<a name="l00553"></a>00553      }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00565"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a17013d85cb47868a9d6b13874c6fdcf6">00565</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a17013d85cb47868a9d6b13874c6fdcf6" title="(SCRIPTABLE) Sets the resolution de Bandwith.">SDevicePSAE4440A::setRbw</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> RBW) {
<a name="l00566"></a>00566 
<a name="l00567"></a>00567      QString cmd;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569      <span class="keywordflow">try</span>{
<a name="l00570"></a>00570 
<a name="l00571"></a>00571           <span class="keywordflow">if</span> (RBW&lt; 1/KHZ){
<a name="l00572"></a>00572                cmd = QString(<span class="stringliteral">&quot;BAND &quot;</span>) + QString::number(RBW, <span class="charliteral">&#39;f&#39;</span>) + QString(<span class="stringliteral">&quot; GHZ&quot;</span>);
<a name="l00573"></a>00573           }<span class="keywordflow">else</span>{ <span class="comment">// for the small RBW, avoid the cmd == 0.000000 GHZ</span>
<a name="l00574"></a>00574                cmd = QString(<span class="stringliteral">&quot;BAND &quot;</span>) + QString::number(RBW*GHZ, <span class="charliteral">&#39;f&#39;</span>) + QString(<span class="stringliteral">&quot; HZ&quot;</span>);
<a name="l00575"></a>00575           }
<a name="l00576"></a>00576           setMetaData( <span class="stringliteral">&quot;rbw&quot;</span>, RBW,<span class="stringliteral">&quot;GHz&quot;</span> ,SMetaData::doublefloat );
<a name="l00577"></a>00577           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00578"></a>00578      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00579"></a>00579           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00580"></a>00580      }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 }
<a name="l00583"></a>00583 
<a name="l00593"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a487ef8e66d8049c5db7fbfb87932a22c">00593</a> <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a487ef8e66d8049c5db7fbfb87932a22c" title="(SCRIPTABLE) Gets the resolution de Bandwith.">SDevicePSAE4440A::rbw</a>(){
<a name="l00594"></a>00594 
<a name="l00595"></a>00595      <span class="keywordflow">try</span>{
<a name="l00596"></a>00596           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;BAND?&quot;</span>);
<a name="l00597"></a>00597           QVariant read = gpibRead(100);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00600"></a>00600                <span class="keywordtype">double</span> rbw_ = read.toDouble()/1.0E9;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602                setMetaData( <span class="stringliteral">&quot;rbw&quot;</span>, rbw_, <span class="stringliteral">&quot;GHz&quot;</span>, SMetaData::doublefloat );
<a name="l00603"></a>00603                <span class="keywordflow">return</span> rbw_; <span class="comment">// sinon on ne peut pas convertir les nombre de la forme 0.0E0 == 0 !!</span>
<a name="l00604"></a>00604 
<a name="l00605"></a>00605                <span class="keywordflow">return</span> read.toDouble()/1.0E9;
<a name="l00606"></a>00606           }<span class="keywordflow">else</span>{
<a name="l00607"></a>00607                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00608"></a>00608           }
<a name="l00609"></a>00609      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00610"></a>00610           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00611"></a>00611           <span class="keywordflow">return</span> 0.0;
<a name="l00612"></a>00612      }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00626"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#afd35d38b158a1324e480e95603db4867">00626</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#afd35d38b158a1324e480e95603db4867" title="(SCRIPTABLE) Sets the attenuation.">SDevicePSAE4440A::setAttenuation</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> Att) {
<a name="l00627"></a>00627      QString cmd;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629      <span class="keywordflow">try</span>{
<a name="l00630"></a>00630           cmd = QString(<span class="stringliteral">&quot;POW:ATT &quot;</span>) + QString::number(Att) + QString(<span class="stringliteral">&quot; dB&quot;</span>);
<a name="l00631"></a>00631           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00632"></a>00632           setMetaData( <span class="stringliteral">&quot;attenuation&quot;</span>, Att,<span class="stringliteral">&quot;dB&quot;</span> ,SMetaData::doublefloat );
<a name="l00633"></a>00633      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00634"></a>00634           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00635"></a>00635      }
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00647"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#adec00060bb3091c15f53488900ba3aa1">00647</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#adec00060bb3091c15f53488900ba3aa1" title="Gets the attenuation.">SDevicePSAE4440A::attenuation</a>(<span class="keywordtype">void</span>){
<a name="l00648"></a>00648 
<a name="l00649"></a>00649      <span class="keywordflow">try</span>{
<a name="l00650"></a>00650           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;POW:ATT?&quot;</span>);
<a name="l00651"></a>00651           QVariant read = gpibRead(100);
<a name="l00652"></a>00652 
<a name="l00653"></a>00653           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00654"></a>00654                <span class="keywordtype">int</span> att = (int)read.toDouble();
<a name="l00655"></a>00655                setMetaData( <span class="stringliteral">&quot;attenuation&quot;</span>, att ,<span class="stringliteral">&quot;dB&quot;</span>,SMetaData::doublefloat );
<a name="l00656"></a>00656                <span class="keywordflow">return</span> att; <span class="comment">// sinon on ne peut pas convertir les nombre de la forme 0.0E0 == 0 !!</span>
<a name="l00657"></a>00657           }<span class="keywordflow">else</span>{
<a name="l00658"></a>00658                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00659"></a>00659           }
<a name="l00660"></a>00660      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00661"></a>00661           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00662"></a>00662           <span class="keywordflow">return</span> 0;
<a name="l00663"></a>00663      }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 }
<a name="l00666"></a>00666 
<a name="l00674"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a3a023a99e6d58c11ede603fcf0f75986">00674</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a3a023a99e6d58c11ede603fcf0f75986" title="(SCRIPTABLE) Sets the number of points for each spectrum sweep.">SDevicePSAE4440A::setNbPoints</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> NbPts) {
<a name="l00675"></a>00675 
<a name="l00676"></a>00676      QString cmd;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678      <span class="keywordflow">try</span>{
<a name="l00679"></a>00679           cmd = QString(<span class="stringliteral">&quot;SWE:POIN &quot;</span>) + QString::number(NbPts);
<a name="l00680"></a>00680           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00681"></a>00681           setMetaData( <span class="stringliteral">&quot;nbPoints&quot;</span>, NbPts,<span class="stringliteral">&quot;&quot;</span> ,SMetaData::doublefloat );
<a name="l00682"></a>00682      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00683"></a>00683           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00684"></a>00684      }
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00696"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a70167afcccc34d98a8c69c568302fbca">00696</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a70167afcccc34d98a8c69c568302fbca" title="(SCRIPTABLE) Gets the number of points for each spectrum sweep.">SDevicePSAE4440A::nbPoints</a>() {
<a name="l00697"></a>00697 
<a name="l00698"></a>00698      <span class="keywordflow">try</span>{
<a name="l00699"></a>00699           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;SWE:POIN?&quot;</span>);
<a name="l00700"></a>00700           QVariant read = gpibRead(100);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">int</span>&gt;() &amp;&amp; read.convert(QVariant::Int) ){
<a name="l00703"></a>00703                <span class="keywordtype">int</span> nb = read.toInt();
<a name="l00704"></a>00704                setMetaData( <span class="stringliteral">&quot;nbPoints&quot;</span>, nb ,<span class="stringliteral">&quot;&quot;</span>,SMetaData::doublefloat );
<a name="l00705"></a>00705                <span class="keywordflow">return</span> nb;
<a name="l00706"></a>00706           }<span class="keywordflow">else</span>{
<a name="l00707"></a>00707                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00708"></a>00708           }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710           
<a name="l00711"></a>00711 
<a name="l00712"></a>00712      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00713"></a>00713           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00714"></a>00714           <span class="keywordflow">return</span> 0;
<a name="l00715"></a>00715      }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00726"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a22962b7a2846b3c78921106a2b72eec4">00726</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a22962b7a2846b3c78921106a2b72eec4" title="(SCRIPTABLE) Sets the number of average, 0 desactivate the average.">SDevicePSAE4440A::setNbAverage</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> NbAvrg) {
<a name="l00727"></a>00727 
<a name="l00728"></a>00728      QString cmd;
<a name="l00729"></a>00729      <span class="keywordflow">try</span>{
<a name="l00730"></a>00730 
<a name="l00731"></a>00731           <span class="keywordflow">if</span> (NbAvrg == 0){
<a name="l00732"></a>00732                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:AVER OFF&quot;</span>);
<a name="l00733"></a>00733 
<a name="l00734"></a>00734           }<span class="keywordflow">else</span> <span class="keywordflow">if</span> ((NbAvrg&gt;0)&amp;&amp;(NbAvrg&lt;=1000))   {
<a name="l00735"></a>00735                cmd = QString(<span class="stringliteral">&quot;:AVER:COUN &quot;</span>) + QString::number(NbAvrg);
<a name="l00736"></a>00736                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00737"></a>00737                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;AVER ON&quot;</span>);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739           }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741           setMetaData( <span class="stringliteral">&quot;nbAverage&quot;</span>, NbAvrg ,<span class="stringliteral">&quot;&quot;</span>,SMetaData::doublefloat );
<a name="l00742"></a>00742 
<a name="l00743"></a>00743      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00744"></a>00744           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00745"></a>00745      }
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00757"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a930f1ae99a8e906d9305c007347b173b">00757</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a930f1ae99a8e906d9305c007347b173b" title="(SCRIPTABLE) Sets the position (in frequency) of the marker number num.">SDevicePSAE4440A::setMarker</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> frequence, <span class="keywordtype">int</span> <span class="keyword">const</span>  num) {
<a name="l00758"></a>00758 
<a name="l00759"></a>00759      QString cmd;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761      <span class="keywordflow">switch</span> (num){
<a name="l00762"></a>00762      <span class="keywordflow">case</span> 1:
<a name="l00763"></a>00763           <span class="keywordflow">if</span>(mark1Active_){
<a name="l00764"></a>00764                cmd = QString(<span class="stringliteral">&quot;CALC:MARK1:X &quot;</span>) + QString::number(frequence, <span class="charliteral">&#39;f&#39;</span>) + QString(<span class="stringliteral">&quot; GHz&quot;</span>);
<a name="l00765"></a>00765           }<span class="keywordflow">else</span>{ <span class="keywordflow">return</span>;}
<a name="l00766"></a>00766           <span class="keywordflow">break</span>;
<a name="l00767"></a>00767      <span class="keywordflow">case</span> 2:
<a name="l00768"></a>00768           <span class="keywordflow">if</span>(mark2Active_){
<a name="l00769"></a>00769                cmd = QString(<span class="stringliteral">&quot;CALC:MARK2:X &quot;</span>) + QString::number(frequence, <span class="charliteral">&#39;f&#39;</span>) + QString(<span class="stringliteral">&quot; GHz&quot;</span>);
<a name="l00770"></a>00770           }<span class="keywordflow">else</span>{ <span class="keywordflow">return</span>;}
<a name="l00771"></a>00771           <span class="keywordflow">break</span>;
<a name="l00772"></a>00772      <span class="keywordflow">default</span>:
<a name="l00773"></a>00773           <span class="keywordflow">return</span>;
<a name="l00774"></a>00774      };
<a name="l00775"></a>00775 
<a name="l00776"></a>00776      <span class="keywordflow">try</span>{
<a name="l00777"></a>00777           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00780"></a>00780           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00781"></a>00781      }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 
<a name="l00785"></a>00785      <span class="keywordtype">bool</span> mark1Active_;
<a name="l00786"></a>00786      <span class="keywordtype">bool</span> mark2Active_; 
<a name="l00787"></a>00787 }
<a name="l00788"></a>00788 
<a name="l00799"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a9e83b95c7105acb2f05dcb6e410ebaa7">00799</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a9e83b95c7105acb2f05dcb6e410ebaa7" title="(SCRIPTABLE) Enable or disable the marker number num. by default num=1;">SDevicePSAE4440A::marker</a>(<span class="keywordtype">bool</span> <span class="keyword">const</span> OnOff, <span class="keywordtype">int</span> <span class="keyword">const</span> num) {
<a name="l00800"></a>00800 
<a name="l00801"></a>00801      QString on;
<a name="l00802"></a>00802      QString off;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804      <span class="keywordflow">switch</span> (num){
<a name="l00805"></a>00805      <span class="keywordflow">case</span> 1:
<a name="l00806"></a>00806           on = <span class="stringliteral">&quot;CALC:MARK1:MODE POS&quot;</span>;
<a name="l00807"></a>00807           off = <span class="stringliteral">&quot;CALC:MARK1:MODE OFF&quot;</span>;
<a name="l00808"></a>00808           <span class="keywordflow">break</span>;
<a name="l00809"></a>00809      <span class="keywordflow">case</span> 2:
<a name="l00810"></a>00810           on = <span class="stringliteral">&quot;CALC:MARK2:MODE POS&quot;</span>;
<a name="l00811"></a>00811           off = <span class="stringliteral">&quot;CALC:MARK2:MODE OFF&quot;</span>;
<a name="l00812"></a>00812           <span class="keywordflow">break</span>;
<a name="l00813"></a>00813      <span class="keywordflow">default</span>:
<a name="l00814"></a>00814           <span class="keywordflow">return</span>;
<a name="l00815"></a>00815      };
<a name="l00816"></a>00816 
<a name="l00817"></a>00817      <span class="keywordflow">try</span>{
<a name="l00818"></a>00818           <span class="keywordflow">if</span> (OnOff){
<a name="l00819"></a>00819                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(on);
<a name="l00820"></a>00820           }<span class="keywordflow">else</span>{
<a name="l00821"></a>00821                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(off);
<a name="l00822"></a>00822           }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00825"></a>00825           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00826"></a>00826      }
<a name="l00827"></a>00827 }
<a name="l00828"></a>00828 
<a name="l00842"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a7170b2ace1d53dd1afceaad77a892e7f">00842</a> <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a7170b2ace1d53dd1afceaad77a892e7f" title="(SCRIPTABLE) returns the Y position of the marker.">SDevicePSAE4440A::readMarker</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> num) {
<a name="l00843"></a>00843 
<a name="l00844"></a>00844      <span class="keywordflow">try</span>{
<a name="l00845"></a>00845 
<a name="l00846"></a>00846           <span class="keywordflow">switch</span> (num){
<a name="l00847"></a>00847           <span class="keywordflow">case</span> 1:
<a name="l00848"></a>00848                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:CALC:MARK1:Y?&quot;</span>);
<a name="l00849"></a>00849                <span class="keywordflow">break</span>;
<a name="l00850"></a>00850           <span class="keywordflow">case</span> 2:
<a name="l00851"></a>00851                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:CALC:MARK2:Y?&quot;</span>);
<a name="l00852"></a>00852                <span class="keywordflow">break</span>;
<a name="l00853"></a>00853           <span class="keywordflow">default</span>:
<a name="l00854"></a>00854                <span class="keywordflow">return</span> 0.0;
<a name="l00855"></a>00855           };
<a name="l00856"></a>00856 
<a name="l00857"></a>00857           QVariant read = gpibRead(50);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00860"></a>00860                <span class="keywordflow">return</span> read.toDouble();
<a name="l00861"></a>00861           }<span class="keywordflow">else</span>{
<a name="l00862"></a>00862                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00863"></a>00863           }
<a name="l00864"></a>00864      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00865"></a>00865           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00866"></a>00866           <span class="keywordflow">return</span> 0.0;
<a name="l00867"></a>00867      }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869 
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 }
<a name="l00872"></a>00872 
<a name="l00880"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa4f6ed9022268913ada58e2d059d8a5d">00880</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa4f6ed9022268913ada58e2d059d8a5d" title="(SCRIPTABLE) Sets the reference level.">SDevicePSAE4440A::setRefLevel</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> RefLvl) {
<a name="l00881"></a>00881 
<a name="l00882"></a>00882      <span class="keywordflow">try</span>{
<a name="l00883"></a>00883           QString cmd = QString(<span class="stringliteral">&quot;DISP:WIND:TRAC:Y:RLEV &quot;</span>) + QString::number(RefLvl, <span class="charliteral">&#39;f&#39;</span>) + QString(<span class="stringliteral">&quot;dBm&quot;</span>);
<a name="l00884"></a>00884           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00885"></a>00885           setMetaData( <span class="stringliteral">&quot;refLevel&quot;</span>, RefLvl ,<span class="stringliteral">&quot;dBm&quot;</span>,SMetaData::doublefloat );
<a name="l00886"></a>00886      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00887"></a>00887           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00888"></a>00888      }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00901"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa824f90525f4693d62fa78371658a5af">00901</a> <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa824f90525f4693d62fa78371658a5af" title="(SCRIPTABLE) Gets the reference level.">SDevicePSAE4440A::refLevel</a>() {
<a name="l00902"></a>00902 
<a name="l00903"></a>00903      <span class="keywordflow">try</span>{
<a name="l00904"></a>00904           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:DISP:WIND:TRAC:Y:RLEV?&quot;</span>);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906           QVariant read = gpibRead(100);
<a name="l00907"></a>00907 
<a name="l00908"></a>00908           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00909"></a>00909                <span class="keywordtype">double</span> lvl = read.toDouble();
<a name="l00910"></a>00910                setMetaData( <span class="stringliteral">&quot;refLevel&quot;</span>, lvl , <span class="stringliteral">&quot;dBm&quot;</span>,SMetaData::doublefloat );
<a name="l00911"></a>00911                <span class="keywordflow">return</span> lvl;
<a name="l00912"></a>00912           }<span class="keywordflow">else</span>{
<a name="l00913"></a>00913                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00914"></a>00914           }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00917"></a>00917           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00918"></a>00918           <span class="keywordflow">return</span> 0;
<a name="l00919"></a>00919      }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 }
<a name="l00922"></a>00922 
<a name="l00932"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa605a2654f0418f073c3c29b807133cd">00932</a> <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa605a2654f0418f073c3c29b807133cd" title="(SCRIPTABLE) Gets the sweep time.">SDevicePSAE4440A::sweepTime</a>() {
<a name="l00933"></a>00933 
<a name="l00934"></a>00934      <span class="keywordflow">try</span>{
<a name="l00935"></a>00935           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:SWE:TIME?&quot;</span>);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937           QVariant read = gpibRead(100);
<a name="l00938"></a>00938 
<a name="l00939"></a>00939           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00940"></a>00940                <span class="keywordflow">return</span> read.toDouble();
<a name="l00941"></a>00941           }<span class="keywordflow">else</span>{
<a name="l00942"></a>00942                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00943"></a>00943           }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00946"></a>00946           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00947"></a>00947           <span class="keywordflow">return</span> 0;
<a name="l00948"></a>00948      }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950 
<a name="l00951"></a>00951 }
<a name="l00952"></a>00952 
<a name="l00968"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a9b28fabc6c7e3b4b4a6ff6a3bac52625">00968</a> <a class="code" href="../../da/d81/class_s_data2_d.html" title="Class for the manipulation of the data in 2 dimensions (y and y).">SData2D</a> * <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a9b28fabc6c7e3b4b4a6ff6a3bac52625" title="Reads a spectrum in the analyzer.">SDevicePSAE4440A::readSpectrum</a>() {
<a name="l00969"></a>00969 
<a name="l00970"></a>00970 
<a name="l00971"></a>00971      <span class="keywordtype">int</span> asStatue =0 ;  <span class="comment">// statue de l&#39;analyseur de spectre</span>
<a name="l00972"></a>00972      QVariant read ;<span class="comment">// variable de stockage des reponnse GPIB</span>
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 
<a name="l00975"></a>00975      <span class="keywordtype">double</span> vrai_delai=0.5 ; <span class="comment">//  // varible obscure venant de MagToolBox</span>
<a name="l00976"></a>00976 
<a name="l00977"></a>00977      <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af6d7518f8a816a087ce3bb4cad7b5f4a" title="(SCRIPTABLE) Gets the stop frequency.">freqStop</a> = this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af6d7518f8a816a087ce3bb4cad7b5f4a" title="(SCRIPTABLE) Gets the stop frequency.">freqStop</a>();
<a name="l00978"></a>00978      <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a5e4e5a2ea2f68035ea4deaa8a523e5d4" title="(SCRIPTABLE) Gets the start frequency.">freqStart</a> = this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a5e4e5a2ea2f68035ea4deaa8a523e5d4" title="(SCRIPTABLE) Gets the start frequency.">freqStart</a>();
<a name="l00979"></a>00979      <span class="keywordtype">int</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a70167afcccc34d98a8c69c568302fbca" title="(SCRIPTABLE) Gets the number of points for each spectrum sweep.">nbPoints</a> = this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a70167afcccc34d98a8c69c568302fbca" title="(SCRIPTABLE) Gets the number of points for each spectrum sweep.">nbPoints</a>();
<a name="l00980"></a>00980 
<a name="l00981"></a>00981      QList&lt;double&gt; spectreX;
<a name="l00982"></a>00982      QList&lt;double&gt; spectreY;
<a name="l00983"></a>00983 
<a name="l00984"></a>00984 
<a name="l00985"></a>00985      <span class="comment">/*---------------------------------*/</span>
<a name="l00986"></a>00986      <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;INIT:IMM&quot;</span>);
<a name="l00987"></a>00987      <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.5);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989      <span class="comment">//on demande l&#39;etat du systeme</span>
<a name="l00990"></a>00990      <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;STAT:OPER?&quot;</span>);
<a name="l00991"></a>00991 
<a name="l00992"></a>00992      read = gpibRead(100);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994      <span class="keywordflow">if</span>(!( read.canConvert&lt;<span class="keywordtype">int</span>&gt;() 
<a name="l00995"></a>00995           &amp;&amp; read.convert(QVariant::Int)) ) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00996"></a>00996      asStatue = read.toInt();
<a name="l00997"></a>00997 
<a name="l00998"></a>00998      <span class="comment">/*---------------------------------*/</span>
<a name="l00999"></a>00999      <span class="comment">// si c&#39;est 40 ou 41 on est sur la mesure d&#39;avant (avec ou non une calib en cours)</span>
<a name="l01000"></a>01000      <span class="keywordflow">if</span> ((asStatue == 41)||(asStatue == 40)){ <span class="comment">//</span>
<a name="l01001"></a>01001 
<a name="l01002"></a>01002           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(2); <span class="comment">// donc on attent un peu qu&#39;il dmare cette mesure</span>
<a name="l01003"></a>01003           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;STAT:OPER?&quot;</span>); <span class="comment">//on re demande l&#39;etat du systeme</span>
<a name="l01004"></a>01004           read = gpibRead(100);
<a name="l01005"></a>01005           <span class="keywordflow">if</span>(!( read.canConvert&lt;<span class="keywordtype">int</span>&gt;() 
<a name="l01006"></a>01006                &amp;&amp; read.convert(QVariant::Int) )) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01007"></a>01007           asStatue = read.toInt();
<a name="l01008"></a>01008      }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010      <span class="comment">/*---------------------------------*/</span>
<a name="l01011"></a>01011 
<a name="l01012"></a>01012      <span class="comment">// on attent que cela ce fasse</span>
<a name="l01013"></a>01013      <span class="keywordflow">while</span> ((asStatue == 1)||(asStatue == 33)||
<a name="l01014"></a>01014           (asStatue == 0)||(asStatue == 32)){  <span class="comment">// 1 et 33 pour recalibration</span>
<a name="l01015"></a>01015 
<a name="l01016"></a>01016                <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.5);
<a name="l01017"></a>01017                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;STAT:OPER?&quot;</span>); <span class="comment">//on re demande l&#39;etat du systeme</span>
<a name="l01018"></a>01018 
<a name="l01019"></a>01019                read = gpibRead(100);
<a name="l01020"></a>01020                <span class="keywordflow">if</span>( !(read.canConvert&lt;<span class="keywordtype">int</span>&gt;() 
<a name="l01021"></a>01021                     &amp;&amp; read.convert(QVariant::Int)) ) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01022"></a>01022                asStatue = read.toInt();
<a name="l01023"></a>01023 
<a name="l01024"></a>01024      }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 
<a name="l01027"></a>01027      <span class="comment">/*---------------------------------*/</span>
<a name="l01028"></a>01028 
<a name="l01029"></a>01029      <span class="comment">//on demande les data</span>
<a name="l01030"></a>01030      <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;TRAC:DATA? TRACE1\r\n&quot;</span>);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032      <span class="comment">//on attend que le registre soit plein</span>
<a name="l01033"></a>01033      <span class="keywordflow">while</span> (( <a class="code" href="../../de/dfb/class_s_device_gpib.html#a99150cfdbf86d3ddf40286567848a1c7" title="Gets the gpib interface.">GpibInterface</a>()-&gt;GPIBibsta() &amp; END) == 0){
<a name="l01034"></a>01034           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(vrai_delai);
<a name="l01035"></a>01035           read = gpibRead(119999L);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037      }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039      <span class="comment">// on rcupere une chaine de caracteres de valeur spares par des virgules</span>
<a name="l01040"></a>01040      <span class="keywordflow">if</span>( !(read.canConvert&lt;QString&gt;() &amp;&amp;
<a name="l01041"></a>01041           read.convert(QVariant::String) )) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01042"></a>01042 
<a name="l01043"></a>01043      QStringList sread= read.toString().split(<span class="charliteral">&#39;,&#39;</span>);
<a name="l01044"></a>01044 
<a name="l01045"></a>01045 
<a name="l01046"></a>01046      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i =0; i &lt; sread.count();i++){
<a name="l01047"></a>01047           spectreY.append(sread.at(i).toDouble());
<a name="l01048"></a>01048           spectreX.append( freqStart + i*(freqStop - freqStart)/(nbPoints-1.0));
<a name="l01049"></a>01049      }
<a name="l01050"></a>01050      <a class="code" href="../../da/d81/class_s_data2_d.html" title="Class for the manipulation of the data in 2 dimensions (y and y).">SData2D</a> * data = <span class="keyword">new</span> <a class="code" href="../../da/d81/class_s_data2_d.html" title="Class for the manipulation of the data in 2 dimensions (y and y).">SData2D</a>(spectreX,spectreY); 
<a name="l01051"></a>01051 
<a name="l01052"></a>01052 
<a name="l01053"></a>01053      data-&gt;<a class="code" href="../../da/d81/class_s_data2_d.html#a2d627b5bd4d3f1492ca0366ceead294e" title="set the name of the columns">setColName</a>(<span class="stringliteral">&quot;Freq&quot;</span>,<span class="stringliteral">&quot;Amp&quot;</span>);
<a name="l01054"></a>01054      data-&gt;<a class="code" href="../../da/d81/class_s_data2_d.html#a9287b893d0955ecb08814ecf1358d356" title="set the units of the columns">setColUnit</a>(<span class="stringliteral">&quot;GHz&quot;</span>,<span class="stringliteral">&quot;V&quot;</span>);
<a name="l01055"></a>01055      <span class="keywordflow">return</span> data;
<a name="l01056"></a>01056 }
<a name="l01057"></a>01057 
<a name="l01067"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a20a4e7344c63b0cd5ef5c54f1b91e932">01067</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a20a4e7344c63b0cd5ef5c54f1b91e932" title="(SCRIPTABLE) read the number of average.">SDevicePSAE4440A::nbAverage</a>(){
<a name="l01068"></a>01068 
<a name="l01069"></a>01069      <span class="keywordflow">try</span>{
<a name="l01070"></a>01070           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;ACP:AVER:COUN?&quot;</span>);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072           QVariant read = gpibRead(100);
<a name="l01073"></a>01073 
<a name="l01074"></a>01074           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">int</span>&gt;() &amp;&amp; read.convert(QVariant::Int) ){
<a name="l01075"></a>01075                <span class="keywordtype">int</span> nb = read.toInt();
<a name="l01076"></a>01076                setMetaData( <span class="stringliteral">&quot;nbAverage&quot;</span>, nb ,<span class="stringliteral">&quot;&quot;</span>,SMetaData::doublefloat );
<a name="l01077"></a>01077                <span class="keywordflow">return</span> nb; 
<a name="l01078"></a>01078                
<a name="l01079"></a>01079           }<span class="keywordflow">else</span>{
<a name="l01080"></a>01080                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01081"></a>01081           }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01084"></a>01084           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01085"></a>01085           <span class="keywordflow">return</span> 0;
<a name="l01086"></a>01086      }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088 }
<a name="l01089"></a>01089 
<a name="l01099"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#ae2d0cd2a69bef82afc941445af3bf2d3">01099</a> QScriptValue <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#ae2d0cd2a69bef82afc941445af3bf2d3" title="(SCRIPTABLE) Gets the spectrum.">SDevicePSAE4440A::qsReadSpectrum</a>(<span class="keywordtype">void</span>){
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 
<a name="l01102"></a>01102      <span class="keywordtype">int</span> asStatue =0 ;  <span class="comment">// statue de l&#39;analyseur de spectre</span>
<a name="l01103"></a>01103      QVariant read ;<span class="comment">// variable de stockage des reponnse GPIB</span>
<a name="l01104"></a>01104 
<a name="l01105"></a>01105 
<a name="l01106"></a>01106      <span class="keywordtype">double</span> vrai_delai=0.5 ; <span class="comment">//  // varible obscure venant de MagToolBox</span>
<a name="l01107"></a>01107 
<a name="l01108"></a>01108      <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af6d7518f8a816a087ce3bb4cad7b5f4a" title="(SCRIPTABLE) Gets the stop frequency.">freqStop</a> = this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af6d7518f8a816a087ce3bb4cad7b5f4a" title="(SCRIPTABLE) Gets the stop frequency.">freqStop</a>();
<a name="l01109"></a>01109      <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a5e4e5a2ea2f68035ea4deaa8a523e5d4" title="(SCRIPTABLE) Gets the start frequency.">freqStart</a> = this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a5e4e5a2ea2f68035ea4deaa8a523e5d4" title="(SCRIPTABLE) Gets the start frequency.">freqStart</a>();
<a name="l01110"></a>01110      <span class="keywordtype">int</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a70167afcccc34d98a8c69c568302fbca" title="(SCRIPTABLE) Gets the number of points for each spectrum sweep.">nbPoints</a> = this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a70167afcccc34d98a8c69c568302fbca" title="(SCRIPTABLE) Gets the number of points for each spectrum sweep.">nbPoints</a>();
<a name="l01111"></a>01111 
<a name="l01112"></a>01112      QList&lt;double&gt; spectreY;
<a name="l01113"></a>01113 
<a name="l01114"></a>01114      <span class="comment">/*---------------------------------*/</span>
<a name="l01115"></a>01115      <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;INIT:IMM&quot;</span>);
<a name="l01116"></a>01116      <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.1);
<a name="l01117"></a>01117 
<a name="l01118"></a>01118      <span class="comment">//on demande l&#39;etat du systeme</span>
<a name="l01119"></a>01119      <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;STAT:OPER?&quot;</span>);
<a name="l01120"></a>01120 
<a name="l01121"></a>01121      read = gpibRead(100);
<a name="l01122"></a>01122 
<a name="l01123"></a>01123      <span class="keywordflow">if</span>(!( read.canConvert&lt;<span class="keywordtype">int</span>&gt;() 
<a name="l01124"></a>01124           &amp;&amp; read.convert(QVariant::Int)) ) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01125"></a>01125      asStatue = read.toInt();
<a name="l01126"></a>01126 
<a name="l01127"></a>01127      <span class="comment">/*---------------------------------*/</span>
<a name="l01128"></a>01128      <span class="comment">// si c&#39;est 40 ou 41 on est sur la mesure d&#39;avant (avec ou non une calib en cours)</span>
<a name="l01129"></a>01129      <span class="keywordflow">if</span> ((asStatue == 41)||(asStatue == 40)){ <span class="comment">//</span>
<a name="l01130"></a>01130           <span class="keywordflow">while</span>((asStatue == 41)||(asStatue == 40)){
<a name="l01131"></a>01131           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.1); <span class="comment">// donc on attent un peu qu&#39;il dmare cette mesure</span>
<a name="l01132"></a>01132           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;STAT:OPER?&quot;</span>); <span class="comment">//on re demande l&#39;etat du systeme</span>
<a name="l01133"></a>01133           read = gpibRead(100);
<a name="l01134"></a>01134           <span class="keywordflow">if</span>(!( read.canConvert&lt;<span class="keywordtype">int</span>&gt;() 
<a name="l01135"></a>01135                &amp;&amp; read.convert(QVariant::Int) )) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01136"></a>01136           asStatue = read.toInt();
<a name="l01137"></a>01137           }
<a name="l01138"></a>01138      }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140      <span class="comment">/*---------------------------------*/</span>
<a name="l01141"></a>01141 
<a name="l01142"></a>01142      <span class="comment">// on attent que cela ce fasse</span>
<a name="l01143"></a>01143      <span class="keywordflow">while</span> ((asStatue == 1)||(asStatue == 33)||
<a name="l01144"></a>01144           (asStatue == 0)||(asStatue == 32)){  <span class="comment">// 1 et 33 pour recalibration</span>
<a name="l01145"></a>01145 
<a name="l01146"></a>01146                <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.2);
<a name="l01147"></a>01147                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;STAT:OPER?&quot;</span>); <span class="comment">//on re demande l&#39;etat du systeme</span>
<a name="l01148"></a>01148 
<a name="l01149"></a>01149                read = gpibRead(100);
<a name="l01150"></a>01150                <span class="keywordflow">if</span>( !(read.canConvert&lt;<span class="keywordtype">int</span>&gt;() 
<a name="l01151"></a>01151                     &amp;&amp; read.convert(QVariant::Int)) ) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01152"></a>01152                asStatue = read.toInt();
<a name="l01153"></a>01153 
<a name="l01154"></a>01154      }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 
<a name="l01157"></a>01157      <span class="comment">/*---------------------------------*/</span>
<a name="l01158"></a>01158 
<a name="l01159"></a>01159      <span class="comment">//on demande les data</span>
<a name="l01160"></a>01160      <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;TRAC:DATA? TRACE1\r\n&quot;</span>);
<a name="l01161"></a>01161 
<a name="l01162"></a>01162      <span class="comment">//on attend que le registre soit plein</span>
<a name="l01163"></a>01163      <span class="keywordflow">while</span> (( <a class="code" href="../../de/dfb/class_s_device_gpib.html#a99150cfdbf86d3ddf40286567848a1c7" title="Gets the gpib interface.">GpibInterface</a>()-&gt;GPIBibsta() &amp; END) == 0){
<a name="l01164"></a>01164           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(vrai_delai);
<a name="l01165"></a>01165           read = gpibRead(119999L);
<a name="l01166"></a>01166 
<a name="l01167"></a>01167      }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169      <span class="comment">// on rcupere une chaine de caracteres de valeur spares par des virgules</span>
<a name="l01170"></a>01170      <span class="keywordflow">if</span>( !(read.canConvert&lt;QString&gt;() &amp;&amp;
<a name="l01171"></a>01171           read.convert(QVariant::String) )) <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173      QStringList sread= read.toString().split(<span class="charliteral">&#39;,&#39;</span>);
<a name="l01174"></a>01174 
<a name="l01175"></a>01175      QString qsCmd;
<a name="l01176"></a>01176      QTextStream qtsCmd(&amp;qsCmd);
<a name="l01177"></a>01177 
<a name="l01178"></a>01178      
<a name="l01179"></a>01179      qtsCmd &lt;&lt; <span class="stringliteral">&quot;var vbn = new SData2D();&quot;</span>;
<a name="l01180"></a>01180 
<a name="l01181"></a>01181      
<a name="l01182"></a>01182      qsCmd.reserve(nbPoints*35);
<a name="l01183"></a>01183 
<a name="l01184"></a>01184      Q_ASSERT(nbPoints==sread.count());
<a name="l01185"></a>01185 
<a name="l01186"></a>01186      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i =0; i &lt; <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a70167afcccc34d98a8c69c568302fbca" title="(SCRIPTABLE) Gets the number of points for each spectrum sweep.">nbPoints</a> ;i++){
<a name="l01187"></a>01187           <span class="comment">// on calcule les abscisse</span>
<a name="l01188"></a>01188           <span class="comment">// on rcupere les ordones</span>
<a name="l01189"></a>01189           qtsCmd &lt;&lt; <span class="stringliteral">&quot;vbn.append(&quot;</span> &lt;&lt; freqStart + i*(freqStop - <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a5e4e5a2ea2f68035ea4deaa8a523e5d4" title="(SCRIPTABLE) Gets the start frequency.">freqStart</a>)/(nbPoints-1.0) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; sread.at(i) &lt;&lt; <span class="stringliteral">&quot;);\n&quot;</span>;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191      }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193      qtsCmd &lt;&lt; <span class="stringliteral">&quot;vbn.setColName(\&quot;Freq\&quot;,\&quot;Amp\&quot;);&quot;</span>;
<a name="l01194"></a>01194      qtsCmd &lt;&lt; <span class="stringliteral">&quot;vbn.setColUnit(\&quot;GHz\&quot;,\&quot;V\&quot;);&quot;</span>;
<a name="l01195"></a>01195      qtsCmd &lt;&lt; <span class="stringliteral">&quot;vbn;&quot;</span>;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197      <span class="keywordflow">return</span>  this-&gt;engine()-&gt;evaluate(qsCmd);;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199 }
<a name="l01200"></a>01200 
<a name="l01206"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa5f4a8448826f7a0ba7e4ec9bd8a3eab">01206</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#aa5f4a8448826f7a0ba7e4ec9bd8a3eab" title="(SCRIPTABLE) reset the average spectrum analyzer.">SDevicePSAE4440A::restart</a>(<span class="keywordtype">void</span>){
<a name="l01207"></a>01207      <span class="keywordflow">try</span>{
<a name="l01208"></a>01208           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:ABOR&quot;</span>);
<a name="l01209"></a>01209      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01210"></a>01210           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01211"></a>01211      }
<a name="l01212"></a>01212 }
<a name="l01213"></a>01213 
<a name="l01221"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a0299436dcf9397062a1214e4b77a63ff">01221</a> QString <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a0299436dcf9397062a1214e4b77a63ff" title="Gets the name.">SDevicePSAE4440A::name</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>{
<a name="l01222"></a>01222 
<a name="l01223"></a>01223      <span class="keywordflow">return</span> <a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>.<a class="code" href="../../de/dbf/struct_s_interface_gpib_1_1_gpib_element.html#a5fd6b597b653ead36383c164371638e3" title="name">name</a>;
<a name="l01224"></a>01224 }
<a name="l01225"></a>01225 
<a name="l01233"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a8054bee54f9187819327093aeecea2b6">01233</a> QString <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a8054bee54f9187819327093aeecea2b6" title="Gets a brief description of the device.">SDevicePSAE4440A::description</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l01234"></a>01234 <span class="keyword"></span>{
<a name="l01235"></a>01235      QString des    =  <span class="stringliteral">&quot;The Agilent E4440A PSA high-performance spectrum analyzer measures and monitors complex RF and&quot;</span>;
<a name="l01236"></a>01236      des  += <span class="stringliteral">&quot;microwave signals up to 26.5 GHz. With optional external mixing, the frequency coverage expands&quot;</span>;
<a name="l01237"></a>01237      des  += <span class="stringliteral">&quot;to 110 GHz by Agilent external mixer, and to 325 GHz by other vendors&#39; mixer.&quot;</span>;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239      <span class="keywordflow">return</span> des;
<a name="l01240"></a>01240 }
<a name="l01241"></a>01241 
<a name="l01249"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6120b6ba6e7ba29ddf260d893b4af06d">01249</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a6120b6ba6e7ba29ddf260d893b4af06d" title="(SCRIPTABLE) Gets the availability.">SDevicePSAE4440A::available</a>(<span class="keywordtype">void</span>){ 
<a name="l01250"></a>01250 
<a name="l01251"></a>01251      <span class="keywordflow">try</span>{
<a name="l01252"></a>01252           <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a> =  <a class="code" href="../../d6/de0/class_s_interface_gpib.html#a9614ff671e7691a82f7d72e908473390" title="get the pointer to the singleton class">SInterfaceGpib::instance</a>();
<a name="l01253"></a>01253           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>= <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a>-&gt;<a class="code" href="../../d6/de0/class_s_interface_gpib.html#a92115b5c23365463b175cc6e31ad1297" title="Searches for the first Gpib element that has a efective name containing name.">findGpibElement</a>(QString(<span class="stringliteral">&quot;Agilent Technologies, E4440A&quot;</span>));
<a name="l01254"></a>01254 
<a name="l01255"></a>01255           available_ = (<a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>.<a class="code" href="../../de/dbf/struct_s_interface_gpib_1_1_gpib_element.html#ac49440ba674b48cf67a16b879db26892" title="Primary address.">PAD</a> !=-1);
<a name="l01256"></a>01256 
<a name="l01257"></a>01257      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01258"></a>01258           <span class="keywordflow">if</span> (!(error == SDEVICEERROR_GPIB_FINDLSTN)){
<a name="l01259"></a>01259                <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);    
<a name="l01260"></a>01260           }<span class="keywordflow">else</span>{
<a name="l01261"></a>01261 
<a name="l01262"></a>01262                this-&gt;<a class="code" href="../../de/dfb/class_s_device_gpib.html#a530c50b8f1abaffcba9bd77844f21a01" title="Sets the device unavailable.">setUnavailable</a>();
<a name="l01263"></a>01263                <span class="comment">//   qDebug() &lt;&lt; &quot;\nAgilent PSAE4440A not found.\n&quot;;</span>
<a name="l01264"></a>01264           }
<a name="l01265"></a>01265 
<a name="l01266"></a>01266      }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268      setMetaData( <span class="stringliteral">&quot;available&quot;</span>, available_ ,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean );
<a name="l01269"></a>01269      <span class="keywordflow">return</span> available_;
<a name="l01270"></a>01270 }
<a name="l01271"></a>01271 
<a name="l01279"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a366c0b0cdf67e7a9206a1d1934e778ba">01279</a> <span class="keywordtype">double</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a366c0b0cdf67e7a9206a1d1934e778ba" title="(SCRIPTABLE) Set and return the acceptable resolution of bandwidth the closest to rbw...">SDevicePSAE4440A::checkRbw</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> rbw){
<a name="l01280"></a>01280      this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a17013d85cb47868a9d6b13874c6fdcf6" title="(SCRIPTABLE) Sets the resolution de Bandwith.">setRbw</a>(rbw);
<a name="l01281"></a>01281      <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.3);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283      <span class="keywordtype">double</span> rbw_ = this-&gt;<a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a487ef8e66d8049c5db7fbfb87932a22c" title="(SCRIPTABLE) Gets the resolution de Bandwith.">rbw</a>();
<a name="l01284"></a>01284      setMetaData( <span class="stringliteral">&quot;rbw&quot;</span>, rbw_,<span class="stringliteral">&quot;&quot;</span>,SMetaData::doublefloat );
<a name="l01285"></a>01285      <span class="keywordflow">return</span> rbw_;
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 
<a name="l01300"></a>01300 <span class="keyword">inline</span> <span class="keywordtype">void</span> SDevicePSAE4440A::setMetaData(<span class="keyword">const</span> QString key, <span class="keyword">const</span> QVariant value, <span class="keyword">const</span> QString unit, 
<a name="l01301"></a>01301                                         <span class="keyword">const</span> SMetaData::enumType type )
<a name="l01302"></a>01302 {
<a name="l01303"></a>01303      <span class="keywordflow">if</span> (metaDataOnOff_) gmdm_.<a class="code" href="../../d3/d8f/class_s_global_meta_data_map.html#a98479144dbfa632c810c5dfd7f854bbe" title="Change the value of the metadata for this device in the global map SGlobalMetaDataMap.">setMetaData</a>(QString(SDEVICEPSAE4440A_SHORT_NAME), key, value,unit, type);
<a name="l01304"></a>01304 
<a name="l01305"></a>01305 }
<a name="l01306"></a>01306 
<a name="l01315"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a43bdde480f9e92ccde9d19eee8dcd419">01315</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a43bdde480f9e92ccde9d19eee8dcd419" title="activate or deactivate the Global Metadata System">SDevicePSAE4440A::metaDataOnOff</a>( <span class="keywordtype">bool</span> onOff )
<a name="l01316"></a>01316 {
<a name="l01317"></a>01317      metaDataOnOff_ = onOff;
<a name="l01318"></a>01318 }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320 
<a name="l01327"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af2e4e4697a3c827b73e91cfe333e527a">01327</a> Q_INVOKABLE  <span class="keywordtype">void</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#af2e4e4697a3c827b73e91cfe333e527a" title="(SCRIPTABLE) Put the display in logarithmic view">SDevicePSAE4440A::setLogDisplay</a>(<span class="keywordtype">bool</span> <span class="keyword">const</span> OnOff){
<a name="l01328"></a>01328      QString mode;
<a name="l01329"></a>01329      <span class="keywordflow">if</span>(OnOff){
<a name="l01330"></a>01330           mode = <span class="stringliteral">&quot;LOG&quot;</span>;
<a name="l01331"></a>01331      }<span class="keywordflow">else</span>{
<a name="l01332"></a>01332           mode = <span class="stringliteral">&quot;LIN&quot;</span>;
<a name="l01333"></a>01333      }
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 
<a name="l01336"></a>01336      <span class="keywordflow">try</span>{
<a name="l01337"></a>01337           QString cmd = QString(<span class="stringliteral">&quot;DISP:WIND:TRAC:Y:SPAC &quot;</span>) + mode;
<a name="l01338"></a>01338           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01339"></a>01339           setMetaData( <span class="stringliteral">&quot;LogDisplay&quot;</span>, OnOff ,<span class="stringliteral">&quot;&quot;</span> ,SMetaData::boolean );
<a name="l01340"></a>01340      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01341"></a>01341           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01342"></a>01342      }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 
<a name="l01345"></a>01345 }
<a name="l01346"></a>01346 
<a name="l01354"></a><a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a8a8a8e4966601524d5fbe0cd0db6aa27">01354</a> Q_INVOKABLE  <span class="keywordtype">bool</span> <a class="code" href="../../d7/df9/class_s_device_p_s_a_e4440_a.html#a8a8a8e4966601524d5fbe0cd0db6aa27" title="(SCRIPTABLE) check if the display is in logarithmic view">SDevicePSAE4440A::logDisplay</a>(){
<a name="l01355"></a>01355 <span class="keywordflow">try</span>{
<a name="l01356"></a>01356      <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;DISP:WIND:TRAC:Y:SPAC?&quot;</span>);
<a name="l01357"></a>01357 
<a name="l01358"></a>01358      QVariant read = gpibRead(100);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360      <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">bool</span>&gt;() &amp;&amp; read.convert(QVariant::Bool) ){
<a name="l01361"></a>01361           <span class="keywordtype">bool</span> log = read.toBool();
<a name="l01362"></a>01362           setMetaData(<span class="stringliteral">&quot;LogDisplay&quot;</span>, log ,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean );
<a name="l01363"></a>01363           <span class="keywordflow">return</span> log; 
<a name="l01364"></a>01364 
<a name="l01365"></a>01365      }<span class="keywordflow">else</span>{
<a name="l01366"></a>01366           <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01367"></a>01367      }
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01370"></a>01370      <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01371"></a>01371      <span class="keywordflow">return</span> 0;
<a name="l01372"></a>01372 }
<a name="l01373"></a>01373 
<a name="l01374"></a>01374 }
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 20:03:28 for SpinToolBox by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
