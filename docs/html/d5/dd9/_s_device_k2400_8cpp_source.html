<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SpinToolBox: D:/Sylvain/Instru/SpinToolBox V2.6/src/plugins/SDevice/SDeviceK2400/SDeviceK2400.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../compass64.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SpinToolBox&#160;<span id="projectnumber">2.6</span></div>
   <div id="projectbrief">Automatize the measurement process in the characterization of the magnetic tunnel junction</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>D:/Sylvain/Instru/SpinToolBox V2.6/src/plugins/SDevice/SDeviceK2400/SDeviceK2400.cpp</h1>  </div>
</div>
<div class="contents">
<a href="../../d5/dd9/_s_device_k2400_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d92/_s_device_k2400_8h.html" title="declare the plugin and the class SDevicek2400">SDeviceK2400.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;SUiCpK2400.h&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;SDKDevice/SDevice/SDeviceError.h&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;QtCore&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;SDKDevice/SDevicePluginInterface.h&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 Q_EXPORT_PLUGIN2(<span class="stringliteral">&quot;SDeviceK2400&quot;</span>, <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html" title="it is the plugin class for include all the functions of the device in the script module.">SDeviceK2400Plugin</a>)
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#aea7125c1fc7603a1a60c66ca2f3335aa">00043</a> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html" title="it is the plugin class for include all the functions of the device in the script module.">SDeviceK2400Plugin</a>::<a class="code" href="../../df/df9/class_s_device_k2400_plugin.html" title="it is the plugin class for include all the functions of the device in the script module.">SDeviceK2400Plugin</a>():state_(2),K2400(NULL)
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 }
<a name="l00056"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#ac35660956a6d0413251b9dab907ba664">00056</a> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#ac35660956a6d0413251b9dab907ba664" title="destructor">SDeviceK2400Plugin::~SDeviceK2400Plugin</a>()
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058      <span class="keywordflow">if</span>(K2400!=NULL)
<a name="l00059"></a>00059           <span class="keyword">delete</span> K2400;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061      <a class="code" href="../../d3/d8f/class_s_global_meta_data_map.html" title="class for passing the metadata between all the device plugins. it is derived of QList">SGlobalMetaDataMap</a> gmdm_;
<a name="l00062"></a>00062      gmdm_.clear(QString(SDEVICEK2400_SHORT_NAME));
<a name="l00063"></a>00063 }
<a name="l00076"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#abd82b7857a322d371ed512d9ff3491fc">00076</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#abd82b7857a322d371ed512d9ff3491fc" title="initialize the plugin">SDeviceK2400Plugin::load</a>()
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078      <span class="comment">//   gmdm_ = GlobalMetaDataMap;</span>
<a name="l00079"></a>00079      K2400 = <span class="keyword">new</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html" title="Provides control of the Keithley K2400 SourceMeter.">SDeviceK2400</a>(<span class="keyword">this</span>);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081      this-&gt;connect(K2400,SIGNAL(<a class="code" href="../../d6/d0c/class_s_device_plugin_interface.html#aa84366ee0438e8bcfc0cc9b02ec4ff0b" title="(Signal) send a signal when the is an error non fatal">logError</a>(QString, QString)),SIGNAL(<a class="code" href="../../d6/d0c/class_s_device_plugin_interface.html#aa84366ee0438e8bcfc0cc9b02ec4ff0b" title="(Signal) send a signal when the is an error non fatal">logError</a>(QString, QString)));
<a name="l00082"></a>00082      this-&gt;connect(K2400,SIGNAL(logEvent(QString, QString)),SIGNAL(logEvent(QString, QString)));
<a name="l00083"></a>00083 
<a name="l00084"></a>00084      <span class="keywordflow">if</span>(K2400-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a5188c674c2e5eff8d8d225c6ccaae4a7" title="is the plugin available ?">available</a>()) state_=0;
<a name="l00085"></a>00085      <span class="keywordflow">return</span> K2400-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a5188c674c2e5eff8d8d225c6ccaae4a7" title="is the plugin available ?">available</a>();
<a name="l00086"></a>00086 }
<a name="l00097"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#ac9e6c766ac8150a42aeccb63d19cf117">00097</a> QString <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#ac9e6c766ac8150a42aeccb63d19cf117" title="return the object name of the metadata.">SDeviceK2400Plugin::name</a>()<span class="keyword"> const</span>
<a name="l00098"></a>00098 <span class="keyword"></span>{
<a name="l00099"></a>00099      <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;KEITHLEY INSTRUMENTS INC., MODEL 2400&quot;</span>);
<a name="l00100"></a>00100 }
<a name="l00111"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a7ff6cb0949bd57e3172af4c50b142274">00111</a> QString <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a7ff6cb0949bd57e3172af4c50b142274" title="return the short name of the plugin.">SDeviceK2400Plugin::shortName</a>()<span class="keyword"> const</span>
<a name="l00112"></a>00112 <span class="keyword"></span>{
<a name="l00113"></a>00113           <span class="keywordflow">return</span> QString(SDEVICEK2400_SHORT_NAME);
<a name="l00114"></a>00114 }
<a name="l00125"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a070af4a00a946996b0203292521de227">00125</a> QString <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a070af4a00a946996b0203292521de227" title="return the description of the plugin">SDeviceK2400Plugin::description</a>()<span class="keyword"> const</span>
<a name="l00126"></a>00126 <span class="keyword"></span>{
<a name="l00127"></a>00127      QString des    = <span class="stringliteral">&quot;Keithley 2400 is designed&quot;</span>;
<a name="l00128"></a>00128      des  +=<span class="stringliteral">&quot; specifically for test applications that demand tightly &quot;</span>;
<a name="l00129"></a>00129      des  +=<span class="stringliteral">&quot;coupled sourcing and measurement.\nAll SourceMeter models &quot;</span>;
<a name="l00130"></a>00130      des  +=<span class="stringliteral">&quot;provide precision voltage and current sourcing as well &quot;</span>;
<a name="l00131"></a>00131      des  +=<span class="stringliteral">&quot;as measurement capabilities. Each SourceMeter instrument &quot;</span>;
<a name="l00132"></a>00132      des  +=<span class="stringliteral">&quot;is both a highly stable DC power source and a true &quot;</span>;
<a name="l00133"></a>00133      des  +=<span class="stringliteral">&quot;instrument-grade 5-1/2 digit multimeter. The power &quot;</span>;
<a name="l00134"></a>00134      des  +=<span class="stringliteral">&quot;source characteristics include low noise, precision, &quot;</span>;
<a name="l00135"></a>00135      des  +=<span class="stringliteral">&quot;and readback. The multimeter capabilities include high &quot;</span>;
<a name="l00136"></a>00136      des  +=<span class="stringliteral">&quot;repeatability and low noise. The result is a compact, &quot;</span>;
<a name="l00137"></a>00137      des  +=<span class="stringliteral">&quot;single-channel, DC parametric tester. In operation, &quot;</span>;
<a name="l00138"></a>00138      des  +=<span class="stringliteral">&quot;these instruments can act as a voltage source, a &quot;</span>;
<a name="l00139"></a>00139      des  +=<span class="stringliteral">&quot;current source, a voltage meter, a current meter, &quot;</span>;
<a name="l00140"></a>00140      des  +=<span class="stringliteral">&quot;and an ohmmeter.&quot;</span>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142      <span class="keywordflow">return</span> des;
<a name="l00143"></a>00143 }
<a name="l00155"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a09fc1ee934b021ff4c36516a993d8535">00155</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a09fc1ee934b021ff4c36516a993d8535" title="add (or not) some functions to the script engine">SDeviceK2400Plugin::scriptable</a>( QScriptEngine * engine )
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157      <span class="keyword">static</span> <span class="keywordtype">bool</span> initialized = <span class="keyword">false</span>;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159      <span class="keywordflow">if</span>(!initialized){ <span class="comment">// evite le multi initialitation</span>
<a name="l00160"></a>00160           <span class="keywordflow">try</span>{
<a name="l00161"></a>00161                initialized = <span class="keyword">true</span>;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163                <a class="code" href="../../da/d0e/class_s_device_k2400.html" title="Provides control of the Keithley K2400 SourceMeter.">SDeviceK2400</a>* K2400Script = <span class="keyword">new</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html" title="Provides control of the Keithley K2400 SourceMeter.">SDeviceK2400</a>();
<a name="l00164"></a>00164                this-&gt;connect(K2400Script,SIGNAL(<a class="code" href="../../d6/d0c/class_s_device_plugin_interface.html#aa84366ee0438e8bcfc0cc9b02ec4ff0b" title="(Signal) send a signal when the is an error non fatal">logError</a>(QString,QString)),SIGNAL(<a class="code" href="../../d6/d0c/class_s_device_plugin_interface.html#aa84366ee0438e8bcfc0cc9b02ec4ff0b" title="(Signal) send a signal when the is an error non fatal">logError</a>(QString,QString)));
<a name="l00165"></a>00165                this-&gt;connect(K2400Script,SIGNAL(logEvent(QString,QString)),SIGNAL(logEvent(QString,QString)));
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                K2400-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a2ab8af7ac1e177568203696e18bc3747" title="(SCRIPTABLE) change the mode of the DC generator, current or voltage.">setMode</a>(SDeviceK2400::CURRENT);
<a name="l00169"></a>00169                QScriptValue qsvSDeviceK2400 = engine-&gt;newQObject(K2400Script,QScriptEngine::ScriptOwnership);
<a name="l00170"></a>00170                QScriptValue qsvMetaSDeviceK2400 = engine-&gt;newQMetaObject(K2400Script-&gt;metaObject());
<a name="l00171"></a>00171 
<a name="l00172"></a>00172                engine-&gt;globalObject().setProperty(<span class="stringliteral">&quot;K2400&quot;</span>, qsvSDeviceK2400);
<a name="l00173"></a>00173                engine-&gt;globalObject().setProperty(<span class="stringliteral">&quot;SDeviceK2400&quot;</span>, qsvMetaSDeviceK2400); <span class="comment">// Pour les Enums</span>
<a name="l00174"></a>00174                engine-&gt;evaluate(<span class="stringliteral">&quot;K2400.readIV = K2400.qsReadIV; K2400.readVI = K2400.qsReadVI;\n&quot;</span>,<span class="stringliteral">&quot;Initialization&quot;</span>);
<a name="l00175"></a>00175                engine-&gt;evaluate(<span class="stringliteral">&quot;K2400.CURRENT = \&quot;CURRENT\&quot;; K2400.VOLTAGE = \&quot;VOLTAGE\&quot;;\n&quot;</span>,<span class="stringliteral">&quot;Initialization&quot;</span>);
<a name="l00176"></a>00176                engine-&gt;evaluate(<span class="stringliteral">&quot;K2400.mode = K2400.qsMode;\n&quot;</span>,<span class="stringliteral">&quot;Initialization&quot;</span>);
<a name="l00177"></a>00177           
<a name="l00178"></a>00178 
<a name="l00179"></a>00179                qDebug()  &lt;&lt; <span class="stringliteral">&quot;Keithley 2400 SourceMeter found&quot;</span>;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181                <span class="keywordflow">if</span>(!K2400-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a5188c674c2e5eff8d8d225c6ccaae4a7" title="is the plugin available ?">available</a>()){
<a name="l00182"></a>00182                     initialized = <span class="keyword">false</span>;
<a name="l00183"></a>00183                     qDebug()  &lt;&lt; <span class="stringliteral">&quot;Keithley 2400 SourceMeter cannot be found&quot;</span>;
<a name="l00184"></a>00184                     engine-&gt;evaluate(<span class="stringliteral">&quot;var K2400 = new Object(); K2400.available = false;&quot;</span>,<span class="stringliteral">&quot;Initialization&quot;</span>);
<a name="l00185"></a>00185                }
<a name="l00186"></a>00186           }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00187"></a>00187                initialized = <span class="keyword">false</span>;
<a name="l00188"></a>00188                engine-&gt;evaluate(<span class="stringliteral">&quot;var K2400 = new Object(); K2400.available = false;&quot;</span>,<span class="stringliteral">&quot;Initialization&quot;</span>);
<a name="l00189"></a>00189                qDebug()  &lt;&lt;<span class="stringliteral">&quot; ERROR (LOW): initialization of the Keithley 2400 SourceMeter&#39;s script object failed&quot;</span> 
<a name="l00190"></a>00190                     &lt;&lt; error;
<a name="l00191"></a>00191                <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193           }
<a name="l00194"></a>00194      }
<a name="l00195"></a>00195      
<a name="l00196"></a>00196      
<a name="l00197"></a>00197      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00198"></a>00198 }
<a name="l00211"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#afbaa2fb45be7552dd95e8e8c7b6c950c">00211</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#afbaa2fb45be7552dd95e8e8c7b6c950c" title="does the plugin add some function to the script engine">SDeviceK2400Plugin::isScriptable</a>()
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00214"></a>00214 }
<a name="l00227"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a75336d90dc45c58486441a77ad0eae02">00227</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a75336d90dc45c58486441a77ad0eae02" title="does the plugin add a tab to the control panel to the script engine">SDeviceK2400Plugin::isControlPanel</a>()
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00230"></a>00230 }
<a name="l00245"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#af858879f66bb971fef6f33aeb985d560">00245</a> QWidget * <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#af858879f66bb971fef6f33aeb985d560" title="add (or not) a tab to the control panel">SDeviceK2400Plugin::controlPanel</a>(QWidget * parent <span class="comment">/*= NULL*/</span>)
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247      
<a name="l00248"></a>00248      QWidget * CtrlPanel = <span class="keyword">new</span> SUiCpK2400(parent);
<a name="l00249"></a>00249      <span class="keywordflow">return</span> CtrlPanel;
<a name="l00250"></a>00250 }
<a name="l00262"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#aeedee0b5d6bb347614abd2aa78768219">00262</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#aeedee0b5d6bb347614abd2aa78768219" title="does the plugin have a setting window ?">SDeviceK2400Plugin::isSetting</a>()
<a name="l00263"></a>00263 {
<a name="l00264"></a>00264      <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00265"></a>00265 }
<a name="l00280"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a601019b9b4e6276af6c7f10c2bd3d17f">00280</a> QWidget * <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a601019b9b4e6276af6c7f10c2bd3d17f" title="(virtual pure) give (or not) a setting window.">SDeviceK2400Plugin::setting</a>(QWidget * parrent <span class="comment">/*= NULL*/</span> )
<a name="l00281"></a>00281 {
<a name="l00282"></a>00282      QWidget * widSetting = <span class="keyword">new</span> QWidget(parrent); 
<a name="l00283"></a>00283      <span class="keywordflow">return</span> widSetting;
<a name="l00284"></a>00284 }
<a name="l00294"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a292a3e18e6b3e35a2fcff80a497b097a">00294</a> <span class="keywordtype">void</span> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a292a3e18e6b3e35a2fcff80a497b097a" title="shutdown the plugin (by example before closing the application)">SDeviceK2400Plugin::shutdown</a>()
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296      K2400-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a05c702043e6d347f0329e778f5bed18c" title="(SCRIPTABLE) Deactivates the DC generator.">deactivate</a>();
<a name="l00297"></a>00297      state_=2;
<a name="l00298"></a>00298 }
<a name="l00309"></a>00309 <span class="keywordtype">int</span> SDeviceK2400Plugin::state()
<a name="l00310"></a>00310 {
<a name="l00311"></a>00311      <span class="keywordflow">return</span> state_;
<a name="l00312"></a>00312 }
<a name="l00323"></a>00323 <span class="keywordtype">bool</span> SDeviceK2400Plugin::available()
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325      <span class="keywordflow">return</span> K2400-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a5188c674c2e5eff8d8d225c6ccaae4a7" title="is the plugin available ?">available</a>();
<a name="l00326"></a>00326 }
<a name="l00335"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a1398ea71066715c87c8be2f917a68ea8">00335</a> QString <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a1398ea71066715c87c8be2f917a68ea8" title="return the version of the SDK that is needed for run the plugin">SDeviceK2400Plugin::plgVersion</a>()<span class="keyword"> const</span>
<a name="l00336"></a>00336 <span class="keyword"></span>{
<a name="l00337"></a>00337      <span class="keywordflow">return</span> QString::number(SDEVICEK2400_VERSION);
<a name="l00338"></a>00338 }
<a name="l00347"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#ac0410b9374b525556c33316a1f3bf670">00347</a> QString <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#ac0410b9374b525556c33316a1f3bf670" title="return the version of the SDK which is required for this plugin">SDeviceK2400Plugin::SDKVersion</a>()<span class="keyword"> const </span>
<a name="l00348"></a>00348 <span class="keyword"></span>{
<a name="l00349"></a>00349      <span class="keywordflow">return</span> QString::number(SDEVICEK2400_MAJOR_VERSION_COMPATIBILITY) + 
<a name="l00350"></a>00350           QString(<span class="stringliteral">&quot;.&quot;</span>) + QString::number(SDEVICEK2400_MINOR_VERSION_COMPATIBILITY);
<a name="l00351"></a>00351 }
<a name="l00362"></a><a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a6722a07a64cbdfc9e78ac04a2a879a78">00362</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/df9/class_s_device_k2400_plugin.html#a6722a07a64cbdfc9e78ac04a2a879a78" title="this function is call when the plugin is unload">SDeviceK2400Plugin::unload</a>()
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364      qDebug()  &lt;&lt;<span class="stringliteral">&quot; WARNING: unloading of the Keithley 2400 SourceMeter&#39;s script object failed \n&quot;</span> ;
<a name="l00365"></a>00365      qDebug()  &lt;&lt;<span class="stringliteral">&quot; \t because the function is not implanted yet\n&quot;</span> ;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d92/_s_device_k2400_8h.html" title="declare the plugin and the class SDevicek2400">SDeviceK2400.h</a>&quot;</span>
<a name="l00377"></a>00377 <span class="preprocessor">#include &quot;SDKDevice/SInterface/SInterfaceGpib.h&quot;</span>
<a name="l00378"></a>00378 <span class="preprocessor">#include &quot;SDKDevice/SDevice/SDeviceGpib.h&quot;</span>
<a name="l00379"></a>00379 <span class="preprocessor">#include &quot;SDKDevice/SDevice/SDeviceVirtual.h&quot;</span>
<a name="l00380"></a>00380 <span class="preprocessor">#include &quot;SDKDevice/SDevicePluginInterface.h&quot;</span>
<a name="l00381"></a>00381 <span class="preprocessor">#include &quot;SDK/SError.h&quot;</span>
<a name="l00382"></a>00382 <span class="preprocessor">#include &quot;SDKDevice/SDevice/SDeviceError.h&quot;</span>
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 <span class="preprocessor">#include &lt;QtCore&gt;</span>
<a name="l00385"></a>00385 <span class="preprocessor">#include &lt;qdebug&gt;</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="preprocessor">#include &lt;QObject&gt;</span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="preprocessor">#include &lt;QScriptable&gt;</span>
<a name="l00390"></a>00390 <span class="preprocessor">#include &lt;QScriptEngine&gt;</span>
<a name="l00391"></a>00391 <span class="preprocessor">#include &lt;QScriptValue&gt;</span>
<a name="l00392"></a>00392 
<a name="l00404"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#afc8b3e49ccc55e1850fda2dae9e0ea9a">00404</a> <a class="code" href="../../da/d0e/class_s_device_k2400.html#afc8b3e49ccc55e1850fda2dae9e0ea9a" title="Default constructor.">SDeviceK2400::SDeviceK2400</a>(QObject *parent) : 
<a name="l00405"></a>00405 <a class="code" href="../../de/dfb/class_s_device_gpib.html" title="class for all the GPIB devices.">SDeviceGpib</a>(parent){
<a name="l00406"></a>00406 
<a name="l00407"></a>00407      <span class="comment">//gmdm_ = GlobalMetaDataMap;</span>
<a name="l00408"></a>00408 
<a name="l00409"></a>00409      <a class="code" href="../../da/d0e/class_s_device_k2400.html#a49df9e431075243e9081ed3080df94d9" title="Current maximum.">Imax</a>=(1);
<a name="l00410"></a>00410      <a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>=(20);
<a name="l00411"></a>00411      available_ = <span class="keyword">false</span>;
<a name="l00412"></a>00412      <a class="code" href="../../da/d0e/class_s_device_k2400.html#afb171313f5911fa1a2354e8568ccb570" title="Initializes the K2400 device.">init</a>();
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00428"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#aeebe2780f11bdd7a817c07cb262b442c">00428</a> <a class="code" href="../../da/d0e/class_s_device_k2400.html#afc8b3e49ccc55e1850fda2dae9e0ea9a" title="Default constructor.">SDeviceK2400::SDeviceK2400</a>(<a class="code" href="../../da/d0e/class_s_device_k2400.html#a0e6ed660804a8caa1fb821427306b43e" title="Values that represent the mode of the DC generator.">MODE</a> mode, QObject *parent): 
<a name="l00429"></a>00429 <a class="code" href="../../de/dfb/class_s_device_gpib.html" title="class for all the GPIB devices.">SDeviceGpib</a>(parent){
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <span class="comment">//   gmdm_ = GlobalMetaDataMap;</span>
<a name="l00432"></a>00432 
<a name="l00433"></a>00433      <a class="code" href="../../da/d0e/class_s_device_k2400.html#a49df9e431075243e9081ed3080df94d9" title="Current maximum.">Imax</a>=(1);
<a name="l00434"></a>00434      <a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>=(20);
<a name="l00435"></a>00435      available_ = <span class="keyword">false</span>;
<a name="l00436"></a>00436      <a class="code" href="../../da/d0e/class_s_device_k2400.html#afb171313f5911fa1a2354e8568ccb570" title="Initializes the K2400 device.">init</a>();
<a name="l00437"></a>00437 
<a name="l00438"></a>00438      <span class="keywordflow">if</span> (available_) <a class="code" href="../../da/d0e/class_s_device_k2400.html#a2ab8af7ac1e177568203696e18bc3747" title="(SCRIPTABLE) change the mode of the DC generator, current or voltage.">setMode</a>(mode);     
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00452"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a5188c674c2e5eff8d8d225c6ccaae4a7">00452</a> <span class="keywordtype">bool</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a5188c674c2e5eff8d8d225c6ccaae4a7" title="is the plugin available ?">SDeviceK2400::available</a>(<span class="keywordtype">void</span>){
<a name="l00453"></a>00453      <span class="keywordflow">try</span>{
<a name="l00454"></a>00454           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>= <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a>-&gt;<a class="code" href="../../d6/de0/class_s_interface_gpib.html#a92115b5c23365463b175cc6e31ad1297" title="Searches for the first Gpib element that has a efective name containing name.">findGpibElement</a>(QString(<span class="stringliteral">&quot;KEITHLEY INSTRUMENTS INC.,MODEL 2400&quot;</span>));
<a name="l00455"></a>00455           available_ = <span class="keyword">true</span>;
<a name="l00456"></a>00456      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00457"></a>00457           available_ = <span class="keyword">false</span>;
<a name="l00458"></a>00458           setMetaData(<span class="stringliteral">&quot;available&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::string);
<a name="l00459"></a>00459           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00460"></a>00460      }
<a name="l00461"></a>00461      setMetaData(<span class="stringliteral">&quot;available&quot;</span>,available_);
<a name="l00462"></a>00462      <span class="keywordflow">return</span> available_;
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00475"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ac7bf6f375df4c86506049e2923bdc4fe">00475</a> <span class="keywordtype">double</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#ac7bf6f375df4c86506049e2923bdc4fe" title="(SCRIPTABLE) Reads the current.">SDeviceK2400::current</a>(<span class="keywordtype">void</span>){
<a name="l00476"></a>00476 
<a name="l00477"></a>00477      QList&lt;double&gt; res =  <a class="code" href="../../da/d0e/class_s_device_k2400.html#ae54fdacaf97b53e7a9d13b96dcb940f6" title="(INDIRECTLY SCRIPTABLE)Reads the current and the voltage.">readIV</a>();
<a name="l00478"></a>00478      setMetaData(<span class="stringliteral">&quot;current&quot;</span>,res.value(0)*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00479"></a>00479      <span class="keywordflow">return</span> res.value(0);
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00497"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a9cfaf35aaf88aee88a29eb8bddf7016b">00497</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a9cfaf35aaf88aee88a29eb8bddf7016b" title="(SCRIPTABLE) Sets a current.">SDeviceK2400::setCurrent</a>(<span class="keywordtype">double</span> current){
<a name="l00498"></a>00498      <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setCurrent : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00499"></a>00499      <span class="keywordflow">if</span>(current&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a49df9e431075243e9081ed3080df94d9" title="Current maximum.">Imax</a>) current = <a class="code" href="../../da/d0e/class_s_device_k2400.html#a49df9e431075243e9081ed3080df94d9" title="Current maximum.">Imax</a>;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501      <span class="keywordflow">try</span>{
<a name="l00502"></a>00502           QString cmd = QString(<span class="stringliteral">&quot;:SOUR:CURR:LEV &quot;</span>) + QString::number(current);
<a name="l00503"></a>00503           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00504"></a>00504           setMetaData(<span class="stringliteral">&quot;current&quot;</span>,current*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00505"></a>00505      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00506"></a>00506           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00507"></a>00507      }
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00520"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ac0328a6452627a0416ee09bd75d0a8ba">00520</a> <span class="keywordtype">double</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#ac0328a6452627a0416ee09bd75d0a8ba" title="(SCRIPTABLE) Reads the voltage.">SDeviceK2400::voltage</a>(<span class="keywordtype">void</span>){
<a name="l00521"></a>00521 
<a name="l00522"></a>00522      QList&lt;double&gt; res =  <a class="code" href="../../da/d0e/class_s_device_k2400.html#a6073cc17a4d50d6ef987fbd8d52afd8c" title="(INDIRECTLY SCRIPTABLE)Reads the voltage and the current.">readVI</a>();
<a name="l00523"></a>00523      setMetaData(<span class="stringliteral">&quot;voltage&quot;</span>,res.value(0)*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00524"></a>00524      <span class="keywordflow">return</span> res.value(0);
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00543"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a91f5773cb3334bc66cf25ac367403e6c">00543</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a91f5773cb3334bc66cf25ac367403e6c" title="(SCRIPTABLE) Sets a voltage.">SDeviceK2400::setVoltage</a>(<span class="keywordtype">double</span> voltage){
<a name="l00544"></a>00544      <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setVoltage : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00545"></a>00545      <span class="keywordflow">if</span>(voltage&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>) voltage = <a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 
<a name="l00548"></a>00548      <span class="keywordflow">try</span>{ 
<a name="l00549"></a>00549           QString cmd = QString(<span class="stringliteral">&quot;:SOUR:VOLT:LEV &quot;</span>) + QString::number(voltage,<span class="charliteral">&#39;f&#39;</span>);
<a name="l00550"></a>00550           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00551"></a>00551           setMetaData(<span class="stringliteral">&quot;voltage&quot;</span>,voltage*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00552"></a>00552      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00553"></a>00553           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00554"></a>00554      }
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00570"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a2ab8af7ac1e177568203696e18bc3747">00570</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a2ab8af7ac1e177568203696e18bc3747" title="(SCRIPTABLE) change the mode of the DC generator, current or voltage.">SDeviceK2400::setMode</a>(<span class="keyword">const</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a0e6ed660804a8caa1fb821427306b43e" title="Values that represent the mode of the DC generator.">MODE</a> mode){
<a name="l00571"></a>00571      <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setMode : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573      <span class="keywordflow">try</span>{
<a name="l00574"></a>00574 
<a name="l00575"></a>00575           <span class="keywordflow">switch</span>(mode){
<a name="l00576"></a>00576           <span class="keywordflow">case</span> CURRENT:
<a name="l00577"></a>00577                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:SOUR:FUNC CURR&quot;</span>);
<a name="l00578"></a>00578                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:SOUR:CURR:MODE FIX&quot;</span>);
<a name="l00579"></a>00579                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:SENS:FUNC \&quot;VOLT\&quot;&quot;</span>);
<a name="l00580"></a>00580                setMetaData(<span class="stringliteral">&quot;mode&quot;</span>,<span class="stringliteral">&quot;current&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::string);
<a name="l00581"></a>00581                <span class="keywordflow">break</span>;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583           <span class="keywordflow">case</span> VOLTAGE:
<a name="l00584"></a>00584                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:SOUR:FUNC VOLT&quot;</span>);
<a name="l00585"></a>00585                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:SOUR:VOLT:MODE FIX&quot;</span>);
<a name="l00586"></a>00586                <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:SENS:FUNC \&quot;CURR\&quot;&quot;</span>);
<a name="l00587"></a>00587                setMetaData(<span class="stringliteral">&quot;mode&quot;</span>,<span class="stringliteral">&quot;voltage&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::string);
<a name="l00588"></a>00588                <span class="keywordflow">break</span>;
<a name="l00589"></a>00589           }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591           <a class="code" href="../../da/d0e/class_s_device_k2400.html#a824861883ecc417e5344363b9a4d01ec" title="mesurement mode">mode_</a> = <a class="code" href="../../da/d0e/class_s_device_k2400.html#add6954b68289d70a3184d757fc21ae7d" title="Gets the mode of the generator (Scriptable through qsMode)">mode</a>;
<a name="l00592"></a>00592      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00593"></a>00593           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00594"></a>00594      }
<a name="l00595"></a>00595 }
<a name="l00609"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a036d1528a0786f49e7229d59fe6619dd">00609</a> Q_INVOKABLE  <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a2ab8af7ac1e177568203696e18bc3747" title="(SCRIPTABLE) change the mode of the DC generator, current or voltage.">SDeviceK2400::setMode</a>( <span class="keyword">const</span> QString mode )
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611      <span class="keywordflow">if</span> (mode.trimmed().toUpper() == <span class="stringliteral">&quot;CURRENT&quot;</span>){
<a name="l00612"></a>00612           <a class="code" href="../../da/d0e/class_s_device_k2400.html#a2ab8af7ac1e177568203696e18bc3747" title="(SCRIPTABLE) change the mode of the DC generator, current or voltage.">setMode</a>(CURRENT);
<a name="l00613"></a>00613      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(mode.trimmed().toUpper() == <span class="stringliteral">&quot;VOLTAGE&quot;</span>){
<a name="l00614"></a>00614           <a class="code" href="../../da/d0e/class_s_device_k2400.html#a2ab8af7ac1e177568203696e18bc3747" title="(SCRIPTABLE) change the mode of the DC generator, current or voltage.">setMode</a>(VOLTAGE);
<a name="l00615"></a>00615      }<span class="keywordflow">else</span>{
<a name="l00616"></a>00616           sendLogError(<span class="stringliteral">&quot;setMode : mode must be \&quot;CURRENT\&quot; or \&quot;VOLTAGE\&quot;&quot;</span>);
<a name="l00617"></a>00617      }
<a name="l00618"></a>00618 }
<a name="l00619"></a>00619 
<a name="l00635"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a6073cc17a4d50d6ef987fbd8d52afd8c">00635</a> QList&lt;double&gt; <a class="code" href="../../da/d0e/class_s_device_k2400.html#a6073cc17a4d50d6ef987fbd8d52afd8c" title="(INDIRECTLY SCRIPTABLE)Reads the voltage and the current.">SDeviceK2400::readVI</a>(<span class="keywordtype">void</span>){
<a name="l00636"></a>00636      <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;readVI : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00637"></a>00637      QList&lt;double&gt; res;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639      <span class="keywordflow">try</span>{
<a name="l00640"></a>00640 
<a name="l00641"></a>00641           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:MEAS:VOLT?&quot;</span>);
<a name="l00642"></a>00642           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.1);
<a name="l00643"></a>00643           QVariant read = gpibRead(100);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645           <span class="keywordflow">if</span>( read.canConvert&lt;QString&gt;() &amp;&amp; read.convert(QVariant::String) ){
<a name="l00646"></a>00646 
<a name="l00647"></a>00647                QStringList sread= read.toString().split(<span class="charliteral">&#39;,&#39;</span>,QString::SkipEmptyParts);
<a name="l00648"></a>00648                res.append(sread.value(0).toDouble());
<a name="l00649"></a>00649                res.append(sread.value(1).toDouble());
<a name="l00650"></a>00650 
<a name="l00651"></a>00651                setMetaData(<span class="stringliteral">&quot;I&quot;</span>,sread.value(1,0).toDouble()*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00652"></a>00652                setMetaData(<span class="stringliteral">&quot;V&quot;</span>,sread.value(0,0).toDouble()*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654                <span class="keywordflow">return</span> res;
<a name="l00655"></a>00655           }<span class="keywordflow">else</span>{
<a name="l00656"></a>00656                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658           }
<a name="l00659"></a>00659      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00660"></a>00660           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00661"></a>00661           <span class="keywordflow">return</span> res;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663      }
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00679"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a3d77024d16e0a9ddd8a31d2b149a6a5c">00679</a> QScriptValue <a class="code" href="../../da/d0e/class_s_device_k2400.html#a3d77024d16e0a9ddd8a31d2b149a6a5c" title="(SCRIPTABLE) Reads the voltage and the current.">SDeviceK2400::qsReadVI</a>(<span class="keywordtype">void</span>){
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 
<a name="l00682"></a>00682      QString qsCmd;
<a name="l00683"></a>00683      QTextStream qtsCmd(&amp;qsCmd);
<a name="l00684"></a>00684      QScriptValue res;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686      <span class="keywordflow">try</span>{
<a name="l00687"></a>00687 
<a name="l00688"></a>00688           QList&lt;double&gt; IV = <a class="code" href="../../da/d0e/class_s_device_k2400.html#a6073cc17a4d50d6ef987fbd8d52afd8c" title="(INDIRECTLY SCRIPTABLE)Reads the voltage and the current.">readVI</a>();
<a name="l00689"></a>00689 
<a name="l00690"></a>00690           <span class="keywordflow">if</span>(IV.count() ==2){
<a name="l00691"></a>00691                qtsCmd &lt;&lt; <span class="stringliteral">&quot;new Array(&quot;</span> &lt;&lt; IV.at(0) &lt;&lt;<span class="stringliteral">&quot; , &quot;</span> &lt;&lt; IV.at(1) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> ;
<a name="l00692"></a>00692           }<span class="keywordflow">else</span>{
<a name="l00693"></a>00693                qtsCmd &lt;&lt; <span class="stringliteral">&quot;new Array(0,0)&quot;</span>;
<a name="l00694"></a>00694                qDebug() &lt;&lt; (<span class="stringliteral">&quot;ERROR (SCRIPT) : readVI fail &quot;</span>);
<a name="l00695"></a>00695           }
<a name="l00696"></a>00696 
<a name="l00697"></a>00697           qsCmd = qtsCmd.readAll();
<a name="l00698"></a>00698 
<a name="l00699"></a>00699           res = this-&gt;engine()-&gt;evaluate(qsCmd);
<a name="l00700"></a>00700      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00701"></a>00701           qtsCmd &lt;&lt; <span class="stringliteral">&quot;new Array(0 , 0)&quot;</span> ;
<a name="l00702"></a>00702           qDebug() &lt;&lt; error;
<a name="l00703"></a>00703           res = this-&gt;engine()-&gt;evaluate(qsCmd);
<a name="l00704"></a>00704      }
<a name="l00705"></a>00705      <span class="keywordflow">return</span> res;
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00722"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ae54fdacaf97b53e7a9d13b96dcb940f6">00722</a> QList&lt;double&gt; <a class="code" href="../../da/d0e/class_s_device_k2400.html#ae54fdacaf97b53e7a9d13b96dcb940f6" title="(INDIRECTLY SCRIPTABLE)Reads the current and the voltage.">SDeviceK2400::readIV</a>(<span class="keywordtype">void</span>){
<a name="l00723"></a>00723      <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;readIV : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00724"></a>00724      QList&lt;double&gt; res;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 
<a name="l00727"></a>00727      <span class="keywordflow">try</span>{
<a name="l00728"></a>00728           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(<span class="stringliteral">&quot;:MEAS:CURR?&quot;</span>);
<a name="l00729"></a>00729           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ae8e437310541b7d17167cca74a60f94c" title="Pause the application for i seconds.">delay</a>(0.1);         
<a name="l00730"></a>00730           QVariant read = gpibRead(100);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732           <span class="keywordflow">if</span>( read.canConvert&lt;QString&gt;() &amp;&amp; read.convert(QVariant::String) ){
<a name="l00733"></a>00733 
<a name="l00734"></a>00734                QStringList sread= read.toString().split(<span class="charliteral">&#39;,&#39;</span>,QString::SkipEmptyParts);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736                res.append(sread.at(1).toDouble());
<a name="l00737"></a>00737                res.append(sread.at(0).toDouble());
<a name="l00738"></a>00738 
<a name="l00739"></a>00739                setMetaData(<span class="stringliteral">&quot;I&quot;</span>,sread.at(1).toDouble()*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00740"></a>00740                setMetaData(<span class="stringliteral">&quot;V&quot;</span>,sread.at(0).toDouble()*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                <span class="keywordflow">return</span> res;
<a name="l00743"></a>00743           }<span class="keywordflow">else</span>{
<a name="l00744"></a>00744                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00745"></a>00745           }
<a name="l00746"></a>00746      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00747"></a>00747           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00748"></a>00748           <span class="keywordflow">return</span> res;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750      }    
<a name="l00751"></a>00751 }
<a name="l00752"></a>00752 
<a name="l00763"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ae7be3070c612801d765ce76114f9a104">00763</a> QScriptValue <a class="code" href="../../da/d0e/class_s_device_k2400.html#ae7be3070c612801d765ce76114f9a104" title="(SCRIPTABLE) Reads the current and the voltage.">SDeviceK2400::qsReadIV</a>(<span class="keywordtype">void</span>){
<a name="l00764"></a>00764 
<a name="l00765"></a>00765      QString qsCmd;
<a name="l00766"></a>00766      QTextStream qtsCmd(&amp;qsCmd);
<a name="l00767"></a>00767 
<a name="l00768"></a>00768      QScriptValue res;
<a name="l00769"></a>00769 
<a name="l00770"></a>00770      <span class="keywordflow">try</span>{
<a name="l00771"></a>00771           QList&lt;double&gt; IV = <a class="code" href="../../da/d0e/class_s_device_k2400.html#ae54fdacaf97b53e7a9d13b96dcb940f6" title="(INDIRECTLY SCRIPTABLE)Reads the current and the voltage.">readIV</a>();
<a name="l00772"></a>00772 
<a name="l00773"></a>00773           <span class="keywordflow">if</span>(IV.count() ==2){
<a name="l00774"></a>00774                qtsCmd &lt;&lt; <span class="stringliteral">&quot;new Array(&quot;</span> &lt;&lt; IV.at(0) &lt;&lt;<span class="stringliteral">&quot; , &quot;</span> &lt;&lt; IV.at(1) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> ;
<a name="l00775"></a>00775           }<span class="keywordflow">else</span>{
<a name="l00776"></a>00776                qtsCmd &lt;&lt; <span class="stringliteral">&quot;new Array(0,0)&quot;</span>;
<a name="l00777"></a>00777                qDebug() &lt;&lt; (<span class="stringliteral">&quot;ERROR (SCRIPT) : readIV fail &quot;</span>);
<a name="l00778"></a>00778           }
<a name="l00779"></a>00779           qsCmd = qtsCmd.readAll();
<a name="l00780"></a>00780 
<a name="l00781"></a>00781           res = this-&gt;engine()-&gt;evaluate(qsCmd);
<a name="l00782"></a>00782      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00783"></a>00783           qtsCmd &lt;&lt; <span class="stringliteral">&quot;new Array(0 , 0)&quot;</span> ;
<a name="l00784"></a>00784           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00785"></a>00785           res = this-&gt;engine()-&gt;evaluate(qsCmd);
<a name="l00786"></a>00786      }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788      <span class="keywordflow">return</span> res;
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 
<a name="l00806"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a330b3eb324ce4cd4849288e3b7fbbcde">00806</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a330b3eb324ce4cd4849288e3b7fbbcde" title="(SCRIPTABLE) Sets the current limit.">SDeviceK2400::setCurrentRange</a>(<span class="keywordtype">double</span> Imax){
<a name="l00807"></a>00807 
<a name="l00808"></a>00808      <span class="keywordflow">try</span>{ 
<a name="l00809"></a>00809           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setCurrentRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00810"></a>00810           QString cmd = QString(<span class="stringliteral">&quot;:SOUR:CURR:RANG &quot;</span>) + QString::number(Imax,<span class="charliteral">&#39;f&#39;</span>);
<a name="l00811"></a>00811           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00812"></a>00812           setMetaData(<span class="stringliteral">&quot;currentRange&quot;</span>,Imax*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00813"></a>00813      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00814"></a>00814           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00815"></a>00815      }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817      this-&gt;Imax = <a class="code" href="../../da/d0e/class_s_device_k2400.html#a49df9e431075243e9081ed3080df94d9" title="Current maximum.">Imax</a>;
<a name="l00818"></a>00818 }
<a name="l00831"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a5ffcaf6ceca23398cd8790d73b345f8c">00831</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a5ffcaf6ceca23398cd8790d73b345f8c" title="(SCRIPTABLE) Sets a voltage limit (compliance).">SDeviceK2400::setVoltageRange</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> Imax){
<a name="l00832"></a>00832 
<a name="l00833"></a>00833      <span class="keywordflow">try</span>{ 
<a name="l00834"></a>00834           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setVoltageRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00835"></a>00835 
<a name="l00836"></a>00836           QString cmd = QString(<span class="stringliteral">&quot;:SOUR:VOLT:RANG &quot;</span>) + QString::number(<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>,<span class="charliteral">&#39;f&#39;</span>);
<a name="l00837"></a>00837           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00838"></a>00838           setMetaData(<span class="stringliteral">&quot;voltageRange&quot;</span>,<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00839"></a>00839      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00840"></a>00840           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00841"></a>00841      }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843      this-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a> = <a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>;
<a name="l00844"></a>00844 }
<a name="l00860"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a2aa30b654d3e0a97552c33fdcb1a081b">00860</a> <span class="keywordtype">double</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a2aa30b654d3e0a97552c33fdcb1a081b" title="(SCRIPTABLE) Gets the current limit.">SDeviceK2400::currentRange</a>(<span class="keywordtype">void</span>){
<a name="l00861"></a>00861 
<a name="l00862"></a>00862      <span class="keywordflow">try</span>{ 
<a name="l00863"></a>00863           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;currentRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00864"></a>00864 
<a name="l00865"></a>00865           QString cmd = QString(<span class="stringliteral">&quot;:SOUR:CURR:RANG?&quot;</span>);
<a name="l00866"></a>00866           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00867"></a>00867 
<a name="l00868"></a>00868           QVariant read = gpibRead();
<a name="l00869"></a>00869           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00870"></a>00870                this-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a49df9e431075243e9081ed3080df94d9" title="Current maximum.">Imax</a> = read.toDouble();
<a name="l00871"></a>00871                setMetaData(<span class="stringliteral">&quot;currentRange&quot;</span>,read.toDouble()*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00872"></a>00872                <span class="keywordflow">return</span> read.toDouble();
<a name="l00873"></a>00873           }<span class="keywordflow">else</span>{
<a name="l00874"></a>00874                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876           }
<a name="l00877"></a>00877      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00878"></a>00878           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00879"></a>00879      }
<a name="l00880"></a>00880      <span class="keywordflow">return</span> (0.0); <span class="comment">// pour faire plaisir au compilo</span>
<a name="l00881"></a>00881 }
<a name="l00882"></a>00882 
<a name="l00899"></a>00899 <span class="keywordtype">double</span> SDeviceK2400::voltageRange(<span class="keywordtype">void</span>){
<a name="l00900"></a>00900 
<a name="l00901"></a>00901      <span class="keywordflow">try</span>{ 
<a name="l00902"></a>00902           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;voltageRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l00903"></a>00903           QString cmd = QString(<span class="stringliteral">&quot;:SOUR:VOLT:RANG?&quot;</span>);
<a name="l00904"></a>00904           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906           QVariant read = gpibRead();
<a name="l00907"></a>00907           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l00908"></a>00908                this-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a> = read.toDouble();
<a name="l00909"></a>00909                setMetaData(<span class="stringliteral">&quot;voltageRange&quot;</span>,read.toDouble()*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00910"></a>00910                <span class="keywordflow">return</span> read.toDouble();
<a name="l00911"></a>00911                
<a name="l00912"></a>00912           }<span class="keywordflow">else</span>{
<a name="l00913"></a>00913                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915           }
<a name="l00916"></a>00916      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00917"></a>00917           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l00918"></a>00918      }
<a name="l00919"></a>00919 
<a name="l00920"></a>00920      <span class="keywordflow">return</span> (0.0); <span class="comment">// pour faire plaisir au compilo</span>
<a name="l00921"></a>00921 }
<a name="l00929"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#afb171313f5911fa1a2354e8568ccb570">00929</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#afb171313f5911fa1a2354e8568ccb570" title="Initializes the K2400 device.">SDeviceK2400::init</a>(<span class="keywordtype">void</span>){
<a name="l00930"></a>00930      
<a name="l00931"></a>00931      setMetaData(<span class="stringliteral">&quot;activate&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l00932"></a>00932      setMetaData(<span class="stringliteral">&quot;available&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l00933"></a>00933      setMetaData(<span class="stringliteral">&quot;V&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00934"></a>00934      setMetaData(<span class="stringliteral">&quot;I&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00935"></a>00935      setMetaData(<span class="stringliteral">&quot;voltageRange&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00936"></a>00936      setMetaData(<span class="stringliteral">&quot;currentRange&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00937"></a>00937      setMetaData(<span class="stringliteral">&quot;voltageCompliance&quot;</span>,<span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00938"></a>00938      setMetaData(<span class="stringliteral">&quot;currentCompliance&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00939"></a>00939      setMetaData(<span class="stringliteral">&quot;Imax&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l00940"></a>00940      setMetaData(<span class="stringliteral">&quot;Vmax&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l00941"></a>00941      setMetaData(<span class="stringliteral">&quot;autoVoltageRange&quot;</span>,<span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l00942"></a>00942      setMetaData(<span class="stringliteral">&quot;autoCurrentRange&quot;</span>,<span class="stringliteral">&quot;N/A&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 
<a name="l00945"></a>00945      <span class="keywordflow">try</span>{
<a name="l00946"></a>00946           <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a> =  <a class="code" href="../../d6/de0/class_s_interface_gpib.html#a9614ff671e7691a82f7d72e908473390" title="get the pointer to the singleton class">SInterfaceGpib::instance</a>();
<a name="l00947"></a>00947           <a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>= <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a>-&gt;<a class="code" href="../../d6/de0/class_s_interface_gpib.html#a92115b5c23365463b175cc6e31ad1297" title="Searches for the first Gpib element that has a efective name containing name.">findGpibElement</a>(QString(<span class="stringliteral">&quot;KEITHLEY INSTRUMENTS INC.,MODEL 2400&quot;</span>));
<a name="l00948"></a>00948 
<a name="l00949"></a>00949           <span class="keywordflow">if</span> (!(<a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>.<a class="code" href="../../de/dbf/struct_s_interface_gpib_1_1_gpib_element.html#ac49440ba674b48cf67a16b879db26892" title="Primary address.">PAD</a> ==-1)) available_ = <span class="keyword">true</span>;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951 
<a name="l00952"></a>00952      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l00953"></a>00953           <span class="keywordflow">if</span> (!(error == SDEVICEERROR_GPIB_FINDLSTN) &amp;&amp; !(error ==SDEVICEERROR_GPIB_DEVICE_UNAVAILABLE)){
<a name="l00954"></a>00954                <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);    
<a name="l00955"></a>00955           }<span class="keywordflow">else</span>{
<a name="l00956"></a>00956 
<a name="l00957"></a>00957                this-&gt;<a class="code" href="../../de/dfb/class_s_device_gpib.html#a530c50b8f1abaffcba9bd77844f21a01" title="Sets the device unavailable.">setUnavailable</a>();
<a name="l00958"></a>00958                qDebug() &lt;&lt; <span class="stringliteral">&quot;the Keithley 2400 cannot be found&quot;</span>;
<a name="l00959"></a>00959           }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961      }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 }
<a name="l00964"></a>00964 
<a name="l00973"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ae97e704018d778b66a15aeacc8d4ff58">00973</a> QString <a class="code" href="../../da/d0e/class_s_device_k2400.html#ae97e704018d778b66a15aeacc8d4ff58" title="return the description of the plugin">SDeviceK2400::description</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>{
<a name="l00974"></a>00974 
<a name="l00975"></a>00975      QString des    = <span class="stringliteral">&quot;Keithley 2400 is designed&quot;</span>;
<a name="l00976"></a>00976      des  +=<span class="stringliteral">&quot; specifically for test applications that demand tightly&quot;</span>;
<a name="l00977"></a>00977      des  +=<span class="stringliteral">&quot;coupled sourcing and measurement.\n All SourceMeter models&quot;</span>;
<a name="l00978"></a>00978      des  +=<span class="stringliteral">&quot;provide precision voltage and current sourcing as well &quot;</span>;
<a name="l00979"></a>00979      des  +=<span class="stringliteral">&quot;as measurement capabilities. Each SourceMeter instrument &quot;</span>;
<a name="l00980"></a>00980      des  +=<span class="stringliteral">&quot;is both a highly stable DC power source and a true &quot;</span>;
<a name="l00981"></a>00981      des  +=<span class="stringliteral">&quot;instrument-grade 5-1/2 digit multimeter. The power &quot;</span>;
<a name="l00982"></a>00982      des  +=<span class="stringliteral">&quot;source characteristics include low noise, precision, &quot;</span>;
<a name="l00983"></a>00983      des  +=<span class="stringliteral">&quot;and readback. The multimeter capabilities include high &quot;</span>;
<a name="l00984"></a>00984      des  +=<span class="stringliteral">&quot;repeatability and low noise. The result is a compact, &quot;</span>;
<a name="l00985"></a>00985      des  +=<span class="stringliteral">&quot;single-channel, DC parametric tester. In operation, &quot;</span>;
<a name="l00986"></a>00986      des  +=<span class="stringliteral">&quot;these instruments can act as a voltage source, a &quot;</span>;
<a name="l00987"></a>00987      des  +=<span class="stringliteral">&quot;current source, a voltage meter, a current meter, &quot;</span>;
<a name="l00988"></a>00988      des  +=<span class="stringliteral">&quot;and an ohmmeter.&quot;</span>;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990      <span class="keywordflow">return</span> des;
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l01001"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a61f621949c4d92213fa3042a2edeb0cf">01001</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a61f621949c4d92213fa3042a2edeb0cf" title="(SCRIPTABLE) Activates the DC generator.">SDeviceK2400::activate</a>(){
<a name="l01002"></a>01002 
<a name="l01003"></a>01003 
<a name="l01004"></a>01004      <span class="keywordflow">try</span>{
<a name="l01005"></a>01005           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setAutoCurrentRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01006"></a>01006           QString cmd = QString(<span class="stringliteral">&quot;OUTP ON&quot;</span>);
<a name="l01007"></a>01007           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01008"></a>01008           setMetaData(<span class="stringliteral">&quot;activate&quot;</span>,<span class="keyword">true</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l01009"></a>01009      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01010"></a>01010           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01011"></a>01011           setMetaData(<span class="stringliteral">&quot;activate&quot;</span>,<span class="keyword">false</span>);
<a name="l01012"></a>01012      }
<a name="l01013"></a>01013 }
<a name="l01014"></a>01014 
<a name="l01023"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a05c702043e6d347f0329e778f5bed18c">01023</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a05c702043e6d347f0329e778f5bed18c" title="(SCRIPTABLE) Deactivates the DC generator.">SDeviceK2400::deactivate</a>(<span class="keywordtype">void</span>){
<a name="l01024"></a>01024 
<a name="l01025"></a>01025 
<a name="l01026"></a>01026      <span class="keywordflow">try</span>{
<a name="l01027"></a>01027           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setAutoCurrentRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01028"></a>01028           QString cmd = QString(<span class="stringliteral">&quot;OUTP OFF&quot;</span>);
<a name="l01029"></a>01029           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01030"></a>01030           setMetaData(<span class="stringliteral">&quot;activate&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l01031"></a>01031      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01032"></a>01032           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01033"></a>01033      }
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01049"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a1d0c3dfc3f2263f457558240dbeb0316">01049</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a1d0c3dfc3f2263f457558240dbeb0316" title="(SCRIPTABLE) Sets a current compliance (limit of protection).">SDeviceK2400::setCurrentCompliance</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> Icomp){
<a name="l01050"></a>01050 
<a name="l01051"></a>01051 
<a name="l01052"></a>01052      <span class="keywordflow">try</span>{
<a name="l01053"></a>01053           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setCurrentCompliance : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01054"></a>01054           QString cmd = QString(<span class="stringliteral">&quot;:SENSe:CURR:PROT &quot;</span>) + QString::number(Icomp,<span class="charliteral">&#39;f&#39;</span>);;
<a name="l01055"></a>01055           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01056"></a>01056           <a class="code" href="../../da/d0e/class_s_device_k2400.html#a49df9e431075243e9081ed3080df94d9" title="Current maximum.">Imax</a> = Icomp;
<a name="l01057"></a>01057           setMetaData(<span class="stringliteral">&quot;currentCompliance&quot;</span>,Icomp*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l01058"></a>01058           setMetaData(<span class="stringliteral">&quot;Imax&quot;</span>, Icomp*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l01059"></a>01059      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01060"></a>01060           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01061"></a>01061      }
<a name="l01062"></a>01062 }
<a name="l01063"></a>01063 
<a name="l01076"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ae2a843882421c25ef0731917205daf6e">01076</a> <span class="keywordtype">double</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#ae2a843882421c25ef0731917205daf6e" title="(SCRIPTABLE) Reads the current compliance (limit of protection).">SDeviceK2400::currentCompliance</a>(<span class="keywordtype">void</span>){
<a name="l01077"></a>01077 
<a name="l01078"></a>01078 
<a name="l01079"></a>01079      <span class="keywordflow">try</span>{ 
<a name="l01080"></a>01080           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;currentCompliance : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01081"></a>01081           QString cmd = QString(<span class="stringliteral">&quot;:SENSe:CURR:PROT?&quot;</span>);
<a name="l01082"></a>01082           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084           QVariant read = gpibRead();
<a name="l01085"></a>01085           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l01086"></a>01086                this-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a> = read.toDouble();
<a name="l01087"></a>01087                setMetaData(<span class="stringliteral">&quot;currentCompliance&quot;</span>,read.toDouble()*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l01088"></a>01088                setMetaData(<span class="stringliteral">&quot;Imax&quot;</span>, read.toDouble()*MILI,<span class="stringliteral">&quot;mA&quot;</span>,SMetaData::doublefloat);
<a name="l01089"></a>01089                <span class="keywordflow">return</span> this-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>;
<a name="l01090"></a>01090           }<span class="keywordflow">else</span>{
<a name="l01091"></a>01091                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093           }
<a name="l01094"></a>01094      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01095"></a>01095           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01096"></a>01096      }
<a name="l01097"></a>01097      <span class="keywordflow">return</span> (0.0); <span class="comment">// pour faire plaisir au compilo</span>
<a name="l01098"></a>01098 }
<a name="l01099"></a>01099 
<a name="l01112"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a5b96f0a9e1bd2422a4d1756bb3fd004a">01112</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a5b96f0a9e1bd2422a4d1756bb3fd004a" title="(SCRIPTABLE) Sets a voltage compliance (limit of protection).">SDeviceK2400::setVoltageCompliance</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> Vcomp){
<a name="l01113"></a>01113 
<a name="l01114"></a>01114 
<a name="l01115"></a>01115      <span class="keywordflow">try</span>{ 
<a name="l01116"></a>01116           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setVoltageCompliance : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01117"></a>01117           QString cmd = QString(<span class="stringliteral">&quot;:SENSe:VOLT:PROT &quot;</span>) + QString::number(Vcomp,<span class="charliteral">&#39;f&#39;</span>);;
<a name="l01118"></a>01118           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01119"></a>01119           <a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>=Vcomp;
<a name="l01120"></a>01120           setMetaData(<span class="stringliteral">&quot;voltageCompliance&quot;</span>,Vcomp*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l01121"></a>01121           setMetaData(<span class="stringliteral">&quot;Vmax&quot;</span>, Vcomp*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l01122"></a>01122      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01123"></a>01123           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01124"></a>01124      }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 }
<a name="l01127"></a>01127 
<a name="l01139"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ad61de4f21e536c2da89e924e70456c1e">01139</a> <span class="keywordtype">double</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#ad61de4f21e536c2da89e924e70456c1e" title="(SCRIPTABLE) Reads the voltage compliance (limit of protection).">SDeviceK2400::voltageCompliance</a>(<span class="keywordtype">void</span>){
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 
<a name="l01142"></a>01142      <span class="keywordflow">try</span>{
<a name="l01143"></a>01143           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;voltageCompliance : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01144"></a>01144           QString cmd = QString(<span class="stringliteral">&quot;:SENSe:VOLT:PROT?&quot;</span>);
<a name="l01145"></a>01145           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01146"></a>01146 
<a name="l01147"></a>01147           QVariant read = gpibRead();
<a name="l01148"></a>01148           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">double</span>&gt;() &amp;&amp; read.convert(QVariant::Double) ){
<a name="l01149"></a>01149                this-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a> = read.toDouble();
<a name="l01150"></a>01150                setMetaData(<span class="stringliteral">&quot;voltageCompliance&quot;</span>,read.toDouble()*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l01151"></a>01151                setMetaData(<span class="stringliteral">&quot;Vmax&quot;</span>, read.toDouble()*MILI,<span class="stringliteral">&quot;mV&quot;</span>,SMetaData::doublefloat);
<a name="l01152"></a>01152                <span class="keywordflow">return</span> this-&gt;<a class="code" href="../../da/d0e/class_s_device_k2400.html#a7880f3d9780e3383ee8479a757927d85" title="Voltage maximum.">Vmax</a>;
<a name="l01153"></a>01153                
<a name="l01154"></a>01154           }<span class="keywordflow">else</span>{
<a name="l01155"></a>01155                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157           }
<a name="l01158"></a>01158      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01159"></a>01159           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01160"></a>01160      }
<a name="l01161"></a>01161      <span class="keywordflow">return</span> (0.0); <span class="comment">// pour faire plaisir au compilo</span>
<a name="l01162"></a>01162 }
<a name="l01163"></a>01163 
<a name="l01172"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ade9811b040f9feab09d8d5ee0fcb4f72">01172</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#ade9811b040f9feab09d8d5ee0fcb4f72" title="(SCRIPTABLE) Puts in local mode (the user can use the front keys).">SDeviceK2400::putLocalMode</a>(<span class="keywordtype">void</span>){
<a name="l01173"></a>01173      <span class="keywordflow">try</span>{
<a name="l01174"></a>01174           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;putLocalMode : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01175"></a>01175           <a class="code" href="../../de/dfb/class_s_device_gpib.html#a50b02d83d5e37d4bea5e5aba0aef3959" title="pointeur to the GPIB board">gpib_</a>-&gt;<a class="code" href="../../d6/de0/class_s_interface_gpib.html#a1cdf36662e1b3b490fcd802c76cd1aa4" title="Place specified device in local mod (i.e. it can be &amp;quot;programmed&amp;quot; from the front panel contr...">enableLocal</a>(<a class="code" href="../../de/dfb/class_s_device_gpib.html#ac84b3aeb2a7099008944de89640f93f8" title="contains the name, the primary and secondary address">elmt_</a>);
<a name="l01176"></a>01176      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01177"></a>01177           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01178"></a>01178      }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180 }
<a name="l01190"></a>01190 <span class="keywordtype">void</span> SDeviceK2400::setMetaData( <span class="keyword">const</span> QString key, <span class="keyword">const</span> QVariant value, <span class="keyword">const</span> QString unit, <span class="keyword">const</span> SMetaData::enumType type)
<a name="l01191"></a>01191 {
<a name="l01192"></a>01192      
<a name="l01193"></a>01193    <span class="keywordflow">if</span>(metaDataOnOff_) gmdm_.<a class="code" href="../../d3/d8f/class_s_global_meta_data_map.html#a98479144dbfa632c810c5dfd7f854bbe" title="Change the value of the metadata for this device in the global map SGlobalMetaDataMap.">setMetaData</a>(QString(SDEVICEK2400_SHORT_NAME),key,value, unit , type);
<a name="l01194"></a>01194      
<a name="l01195"></a>01195 }
<a name="l01196"></a>01196 
<a name="l01205"></a>01205 <span class="keywordtype">void</span> SDeviceK2400::metaDataOnOff( <span class="keywordtype">bool</span> onOff )
<a name="l01206"></a>01206 {
<a name="l01207"></a>01207      metaDataOnOff_ = onOff;
<a name="l01208"></a>01208 }
<a name="l01209"></a>01209 
<a name="l01229"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#aeb0300e217ce22cf0d1f084a90f87f53">01229</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#aeb0300e217ce22cf0d1f084a90f87f53" title="activate or deactivate the auto current range function.">SDeviceK2400::setAutoCurrentRange</a>( <span class="keywordtype">bool</span> onOff )
<a name="l01230"></a>01230 {
<a name="l01231"></a>01231      
<a name="l01232"></a>01232      <span class="keywordflow">try</span>{ 
<a name="l01233"></a>01233           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setAutoCurrentRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01234"></a>01234           QString cmd;
<a name="l01235"></a>01235 
<a name="l01236"></a>01236           <span class="keywordflow">if</span> (onOff){
<a name="l01237"></a>01237                cmd = QString(<span class="stringliteral">&quot;:SENSe:CURRent:RANGe:AUTO ON&quot;</span>);
<a name="l01238"></a>01238           }<span class="keywordflow">else</span>{
<a name="l01239"></a>01239              cmd = QString(<span class="stringliteral">&quot;:SENSe:CURRent:RANGe:AUTO OFF&quot;</span>);
<a name="l01240"></a>01240           }
<a name="l01241"></a>01241 
<a name="l01242"></a>01242 
<a name="l01243"></a>01243           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01244"></a>01244 
<a name="l01245"></a>01245           setMetaData(<span class="stringliteral">&quot;autoCurrentRange&quot;</span>,onOff,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l01246"></a>01246 
<a name="l01247"></a>01247 
<a name="l01248"></a>01248      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01249"></a>01249           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01250"></a>01250      }
<a name="l01251"></a>01251 }
<a name="l01252"></a>01252 
<a name="l01272"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#afc0e99592f3b7a970654a5405b2e3f9c">01272</a>  <span class="keywordtype">void</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#afc0e99592f3b7a970654a5405b2e3f9c" title="activate or deactivate the auto voltage range function">SDeviceK2400::setAutoVoltageRange</a>( <span class="keywordtype">bool</span> onOff )
<a name="l01273"></a>01273 {
<a name="l01274"></a>01274      <span class="keywordflow">try</span>{ 
<a name="l01275"></a>01275           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;setAutoVoltageRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01276"></a>01276           QString cmd;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278           <span class="keywordflow">if</span> (onOff){
<a name="l01279"></a>01279                cmd = QString(<span class="stringliteral">&quot;:SENSe:VOLTage:RANGe:AUTO ON&quot;</span>);
<a name="l01280"></a>01280           }<span class="keywordflow">else</span>{
<a name="l01281"></a>01281                cmd = QString(<span class="stringliteral">&quot;:SENSe:VOLTage:RANGe:AUTO OFF&quot;</span>);
<a name="l01282"></a>01282           }
<a name="l01283"></a>01283 
<a name="l01284"></a>01284           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01285"></a>01285           setMetaData(<span class="stringliteral">&quot;autoVoltageRange&quot;</span>,onOff,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 
<a name="l01288"></a>01288      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01289"></a>01289           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01290"></a>01290      }
<a name="l01291"></a>01291 }
<a name="l01311"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#a03abbcdf83c5a25a85afd2e3e749f0ec">01311</a> <span class="keywordtype">bool</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a03abbcdf83c5a25a85afd2e3e749f0ec" title="read if the auto current range function is activated or deactivated">SDeviceK2400::autoCurrentRange</a>()
<a name="l01312"></a>01312 {
<a name="l01313"></a>01313 
<a name="l01314"></a>01314      <span class="keywordflow">try</span>{
<a name="l01315"></a>01315           <span class="keywordflow">if</span> (!available_) sendLogError(<span class="stringliteral">&quot;autoCurrentRange : &quot;</span> + STRING_ERROR_GPIB_DEVICE_UNAVAILABLE);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317           QString cmd = QString(<span class="stringliteral">&quot;:SENSe:CURRent:RANGe:AUTO?&quot;</span>);
<a name="l01318"></a>01318           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01319"></a>01319 
<a name="l01320"></a>01320           QVariant read = gpibRead();
<a name="l01321"></a>01321           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">bool</span>&gt;() &amp;&amp; read.convert(QVariant::Bool) ){
<a name="l01322"></a>01322                <span class="keywordtype">bool</span> autoCurrentRange_ = read.toBool();
<a name="l01323"></a>01323 
<a name="l01324"></a>01324                setMetaData(<span class="stringliteral">&quot;autoCurrentRange&quot;</span>,autoCurrentRange_,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l01325"></a>01325                <span class="keywordflow">return</span> autoCurrentRange_;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327           }<span class="keywordflow">else</span>{
<a name="l01328"></a>01328                sendLogError(<span class="stringliteral">&quot;autoCurrentRange : &quot;</span> + STRING_ERROR_CANNOT_CONVERT_DATA);
<a name="l01329"></a>01329                <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01330"></a>01330           }
<a name="l01331"></a>01331      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01332"></a>01332           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01333"></a>01333      }
<a name="l01334"></a>01334      <span class="keywordflow">return</span> (<span class="keyword">false</span>); <span class="comment">// pour faire plaisir au compilo</span>
<a name="l01335"></a>01335 }
<a name="l01355"></a>01355 Q_INVOKABLE  <span class="keywordtype">bool</span> SDeviceK2400::autoVoltageRange()
<a name="l01356"></a>01356 {
<a name="l01357"></a>01357      <span class="keywordflow">try</span>{
<a name="l01358"></a>01358           <span class="keywordflow">if</span> (!available_) <span class="keywordflow">throw</span> SDEVICEERROR_GPIB_DEVICE_UNAVAILABLE;
<a name="l01359"></a>01359           QString cmd = QString(<span class="stringliteral">&quot;:SENSe:VOLTage:RANGe:AUTO?&quot;</span>);
<a name="l01360"></a>01360           <a class="code" href="../../de/dfb/class_s_device_gpib.html#aafea56d948cb3c0a5c6bbb557676fb05" title="send a direct commande to this device by gbib.">gpibSend</a>(cmd);
<a name="l01361"></a>01361 
<a name="l01362"></a>01362           QVariant read = gpibRead();
<a name="l01363"></a>01363           <span class="keywordflow">if</span>( read.canConvert&lt;<span class="keywordtype">bool</span>&gt;() &amp;&amp; read.convert(QVariant::Bool) ){
<a name="l01364"></a>01364                <span class="keywordtype">bool</span> autoVoltageRange_ = read.toBool();
<a name="l01365"></a>01365 
<a name="l01366"></a>01366                setMetaData(<span class="stringliteral">&quot;autoVoltageRange&quot;</span>,autoVoltageRange_,<span class="stringliteral">&quot;&quot;</span>,SMetaData::boolean);
<a name="l01367"></a>01367                <span class="keywordflow">return</span> autoVoltageRange_;
<a name="l01368"></a>01368 
<a name="l01369"></a>01369           }<span class="keywordflow">else</span>{
<a name="l01370"></a>01370                <span class="keywordflow">throw</span> SDEVICEERROR_CANNOT_CONVERT_DATA;
<a name="l01371"></a>01371 
<a name="l01372"></a>01372           }
<a name="l01373"></a>01373      }<span class="keywordflow">catch</span>(<a class="code" href="../../d9/d03/class_s_error.html" title="class of object throw when an exception has been came.">SError</a> error){
<a name="l01374"></a>01374           <a class="code" href="../../d9/d03/class_s_error.html#aa1f18fb5e98728c5e1c351444b51b31f" title="Traitements.">SError::traitement</a>(<span class="keyword">this</span>,error);
<a name="l01375"></a>01375      }
<a name="l01376"></a>01376      <span class="keywordflow">return</span> (<span class="keyword">false</span>); <span class="comment">// pour faire plaisir au compilo</span>
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01390"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#ab6b24decfb13f30faafb0e98cd9fd21e">01390</a> <span class="keywordtype">bool</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#ab6b24decfb13f30faafb0e98cd9fd21e" title="read if the auto voltage range function is activated or deactivated">SDeviceK2400::isActivated</a>( ){
<a name="l01391"></a>01391 
<a name="l01392"></a>01392      <span class="keywordflow">return</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#aac852665266c5ee7f03eaf94dac19cc0" title="device activated or not">isActivated_</a>;
<a name="l01393"></a>01393 }
<a name="l01394"></a>01394 
<a name="l01406"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#add6954b68289d70a3184d757fc21ae7d">01406</a> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a0e6ed660804a8caa1fb821427306b43e" title="Values that represent the mode of the DC generator.">SDeviceK2400::MODE</a> <a class="code" href="../../da/d0e/class_s_device_k2400.html#add6954b68289d70a3184d757fc21ae7d" title="Gets the mode of the generator (Scriptable through qsMode)">SDeviceK2400::mode</a>( ) {
<a name="l01407"></a>01407 
<a name="l01408"></a>01408      <span class="keywordflow">return</span> <a class="code" href="../../da/d0e/class_s_device_k2400.html#a824861883ecc417e5344363b9a4d01ec" title="mesurement mode">mode_</a>;
<a name="l01409"></a>01409 }
<a name="l01410"></a>01410 
<a name="l01424"></a><a class="code" href="../../da/d0e/class_s_device_k2400.html#af1adbbab431425276edfcdbcbabf4ab4">01424</a> Q_INVOKABLE  QString <a class="code" href="../../da/d0e/class_s_device_k2400.html#af1adbbab431425276edfcdbcbabf4ab4" title="(SCRIPTABLE) Gets the mode of the generator">SDeviceK2400::qsMode</a>()
<a name="l01425"></a>01425 {
<a name="l01426"></a>01426  <span class="keywordflow">if</span>(<a class="code" href="../../da/d0e/class_s_device_k2400.html#a824861883ecc417e5344363b9a4d01ec" title="mesurement mode">mode_</a> == CURRENT) {
<a name="l01427"></a>01427       <span class="keywordflow">return</span> <span class="stringliteral">&quot;CURRENT&quot;</span>;
<a name="l01428"></a>01428  }<span class="keywordflow">else</span>{
<a name="l01429"></a>01429       <span class="keywordflow">return</span> <span class="stringliteral">&quot;VOLTAGE&quot;</span>;
<a name="l01430"></a>01430  }
<a name="l01431"></a>01431 }
<a name="l01432"></a>01432 
<a name="l01433"></a>01433 
<a name="l01441"></a>01441 <span class="keywordtype">void</span> SDeviceK2400::sendLogError( QString log )
<a name="l01442"></a>01442 {
<a name="l01443"></a>01443      emit <a class="code" href="../../da/d0e/class_s_device_k2400.html#abdaa047ca14a289f8ba98ab303f96401" title="(Signal) send a signal when the is an error non fatal">logError</a>(QString(<span class="stringliteral">&quot;WARNING : VISA :An error occurred opening a session to&quot;</span>), SDEVICEK2400_SHORT_NAME);
<a name="l01444"></a>01444 }
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 20:03:28 for SpinToolBox by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
