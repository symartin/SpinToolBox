<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SpinToolBox: D:/Sylvain/Instru/SpinToolBox V2.6/src/SpinToolBox/SUi/SUiScriptEditor.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../compass64.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SpinToolBox&#160;<span id="projectnumber">2.6</span></div>
   <div id="projectbrief">Automatize the measurement process in the characterization of the magnetic tunnel junction</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>D:/Sylvain/Instru/SpinToolBox V2.6/src/SpinToolBox/SUi/SUiScriptEditor.cpp</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">/****************************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">**</span>
<a name="l00004"></a>00004 <span class="comment">** Copyright (C) 2004-2006 Trolltech ASA. All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment">**</span>
<a name="l00006"></a>00006 <span class="comment">** This file is part of the example classes of the Qt Toolkit.</span>
<a name="l00007"></a>00007 <span class="comment">**</span>
<a name="l00008"></a>00008 <span class="comment">** Licensees holding a valid Qt License Agreement may use this file in</span>
<a name="l00009"></a>00009 <span class="comment">** accordance with the rights, responsibilities and obligations</span>
<a name="l00010"></a>00010 <span class="comment">** contained therein.  Please consult your licensing agreement or</span>
<a name="l00011"></a>00011 <span class="comment">** contact sales@trolltech.com if any conditions of this licensing</span>
<a name="l00012"></a>00012 <span class="comment">** agreement are not clear to you.</span>
<a name="l00013"></a>00013 <span class="comment">**</span>
<a name="l00014"></a>00014 <span class="comment">** Further information about Qt licensing is available at:</span>
<a name="l00015"></a>00015 <span class="comment">** http://www.trolltech.com/products/qt/licensing.html or by</span>
<a name="l00016"></a>00016 <span class="comment">** contacting info@trolltech.com.</span>
<a name="l00017"></a>00017 <span class="comment">**</span>
<a name="l00018"></a>00018 <span class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
<a name="l00019"></a>00019 <span class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l00020"></a>00020 <span class="comment">**</span>
<a name="l00021"></a>00021 <span class="comment">****************************************************************************/</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;QtGui&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;QApplication&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;Qsci/qsciscintilla.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;Qsci/qscilexerjavascript.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;Qsci/qsciapis.h&gt;</span> 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;QtScriptTools/qscriptenginedebugger.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;SScript\SScriptEngine.h&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;SUiScriptEditor.h&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 SUiScriptEditor::SUiScriptEditor(<a class="code" href="../../d7/da0/class_s_script_engine.html" title="this is a derivate class from QScriptEngine which initialize the the script engine for SpinToolBox...">SScriptEngine</a>* qsEngine  , QString file,  QWidget * parent):
<a name="l00037"></a>00037 QMainWindow(parent), qsEng(qsEngine),
<a name="l00038"></a>00038      tabDbgCurrentTab(0),
<a name="l00039"></a>00039      lexerJSDebugComp(NULL)
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041 
<a name="l00042"></a>00042      <span class="comment">//Scintilla text edit</span>
<a name="l00043"></a>00043      txtSci = <span class="keyword">new</span> QsciScintilla(<span class="keyword">this</span>);
<a name="l00044"></a>00044      txtSci-&gt;SendScintilla(QsciScintilla::SCI_SETHSCROLLBAR,0);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046      setupUI();
<a name="l00047"></a>00047      createActions();
<a name="l00048"></a>00048      createMenus();
<a name="l00049"></a>00049      createToolBars();
<a name="l00050"></a>00050      createStatusBar();
<a name="l00051"></a>00051      createScintilla();
<a name="l00052"></a>00052      readSettings();
<a name="l00053"></a>00053 
<a name="l00054"></a>00054      <span class="comment">//we connect the window with the script engine</span>
<a name="l00055"></a>00055      this-&gt;connect(<span class="keyword">this</span>, SIGNAL(run(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;, <span class="keywordtype">int</span>, <span class="keywordtype">bool</span>)), 
<a name="l00056"></a>00056           qsEngine, SLOT(run(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;, <span class="keywordtype">int</span>, <span class="keywordtype">bool</span>)));
<a name="l00057"></a>00057 
<a name="l00058"></a>00058      this-&gt;connect(qsEngine, SIGNAL(alreadyRun()), <span class="keyword">this</span>, SLOT(alreadyRun()));
<a name="l00059"></a>00059      this-&gt;connect(qsEngine-&gt;debugger(), SIGNAL(evaluationSuspended()),this , SLOT(swichToDebugMode()));
<a name="l00060"></a>00060      this-&gt;connect(qsEngine-&gt;debugger(), SIGNAL(evaluationResumed()),this , SLOT(swichToEditMode()));
<a name="l00061"></a>00061 
<a name="l00062"></a>00062      connect(qApp, SIGNAL(focusChanged ( QWidget * , QWidget *  ) ),<span class="keyword">this</span>,SLOT(onFocus(QWidget * , QWidget * )));
<a name="l00063"></a>00063      connect(<span class="keyword">this</span>, SIGNAL(abortEngine()), qsEngine, SLOT(abort()));
<a name="l00064"></a>00064 
<a name="l00065"></a>00065      <span class="keywordflow">if</span>(!file.isEmpty()){
<a name="l00066"></a>00066           loadFile(file);
<a name="l00067"></a>00067      }<span class="keywordflow">else</span>{
<a name="l00068"></a>00068           setCurrentFile(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00069"></a>00069      }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071      this-&gt;setWindowIcon(QIcon(<span class="stringliteral">&quot;:icon/scriptedit.png&quot;</span>));
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keywordtype">void</span> SUiScriptEditor::closeEvent(QCloseEvent *event)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078      <span class="keywordflow">if</span> (maybeSave()) {
<a name="l00079"></a>00079           writeSettings();
<a name="l00080"></a>00080           <span class="keyword">event</span>-&gt;accept();
<a name="l00081"></a>00081      } <span class="keywordflow">else</span> {
<a name="l00082"></a>00082           <span class="keyword">event</span>-&gt;ignore();
<a name="l00083"></a>00083      }
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="keywordtype">void</span> SUiScriptEditor::newFile()
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088      <span class="keywordflow">if</span> (maybeSave()) {
<a name="l00089"></a>00089           txtSci-&gt;clear();
<a name="l00090"></a>00090           setCurrentFile(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00091"></a>00091      }
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="keywordtype">void</span> SUiScriptEditor::open()
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096      <span class="keywordflow">if</span> (maybeSave()) {
<a name="l00097"></a>00097           QString fileName = QFileDialog::getOpenFileName(<span class="keyword">this</span>, <span class="stringliteral">&quot;Choose a script file&quot;</span>,
<a name="l00098"></a>00098                QApplication::applicationDirPath (), 
<a name="l00099"></a>00099                <span class="stringliteral">&quot;Script Files (*.js *.stb.js);;Other text file (*.txt *.*)&quot;</span>);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101           <span class="keywordflow">if</span> (!fileName.isEmpty())
<a name="l00102"></a>00102                loadFile(fileName);
<a name="l00103"></a>00103      }
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="keywordtype">bool</span> SUiScriptEditor::save()
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108      <span class="keywordflow">if</span> (curFile.isEmpty()) {
<a name="l00109"></a>00109           <span class="keywordflow">return</span> saveAs();
<a name="l00110"></a>00110      } <span class="keywordflow">else</span> {
<a name="l00111"></a>00111           <span class="keywordflow">return</span> saveFile(curFile);
<a name="l00112"></a>00112      }
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="keywordtype">bool</span> SUiScriptEditor::saveAs()
<a name="l00116"></a>00116 {
<a name="l00117"></a>00117      QString fileName = QFileDialog::getSaveFileName(<span class="keyword">this</span>, <span class="stringliteral">&quot;Choose a script file&quot;</span>, QApplication::applicationDirPath (), 
<a name="l00118"></a>00118           <span class="stringliteral">&quot;Script Files (*.js *.stb.js);;Other text file (*.txt *.*)&quot;</span>);
<a name="l00119"></a>00119      <span class="keywordflow">if</span> (fileName.isEmpty())
<a name="l00120"></a>00120           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122      <span class="keywordflow">return</span> saveFile(fileName);
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="keywordtype">void</span> SUiScriptEditor::about()
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127      QMessageBox::about(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;About SpinToolBox&quot;</span>),
<a name="l00128"></a>00128           tr(<span class="stringliteral">&quot;The &lt;b&gt;Application&lt;/b&gt; example demonstrates how to &quot;</span>
<a name="l00129"></a>00129           <span class="stringliteral">&quot;write modern GUI applications using Qt, with a menu bar, &quot;</span>
<a name="l00130"></a>00130           <span class="stringliteral">&quot;toolbars, and a status bar.&quot;</span>));
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="keywordtype">void</span> SUiScriptEditor::documentWasModified()
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135      setWindowModified(txtSci-&gt;isModified());
<a name="l00136"></a>00136 }
<a name="l00143"></a>00143 <span class="keywordtype">void</span> SUiScriptEditor::createActions(){
<a name="l00144"></a>00144 
<a name="l00145"></a>00145      <span class="comment">//action of execute the script</span>
<a name="l00146"></a>00146      actExecute = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/execute.png&quot;</span>), <span class="stringliteral">&quot;Execute&quot;</span>,<span class="keyword">this</span>);
<a name="l00147"></a>00147      actExecute-&gt;setShortcut(Qt::CTRL +  Qt::Key_E);
<a name="l00148"></a>00148      actExecute-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Execute the script&quot;</span>));
<a name="l00149"></a>00149      connect(actExecute, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(execute()));
<a name="l00150"></a>00150 
<a name="l00151"></a>00151      <span class="comment">//action execute the selected text</span>
<a name="l00152"></a>00152      actSelectedExecute = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/execute.png&quot;</span>), <span class="stringliteral">&quot;Execute the selected text&quot;</span>,<span class="keyword">this</span>);
<a name="l00153"></a>00153      actSelectedExecute-&gt;setShortcut(Qt::CTRL + Qt::SHIFT +  Qt::Key_E);
<a name="l00154"></a>00154      actSelectedExecute-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Execute the selected text&quot;</span>));
<a name="l00155"></a>00155      connect(actSelectedExecute, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(executeSelectedText()));
<a name="l00156"></a>00156 
<a name="l00157"></a>00157      <span class="comment">// action of toggle the debugger</span>
<a name="l00158"></a>00158      actDebugTogg = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/debug.png&quot;</span>), tr(<span class="stringliteral">&quot;&amp;Debugger&quot;</span>), <span class="keyword">this</span>);
<a name="l00159"></a>00159      actDebugTogg-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Activate/deactivate the debugger&quot;</span>));
<a name="l00160"></a>00160      actDebugTogg-&gt;setShortcut(Qt::CTRL  + Qt::Key_D);
<a name="l00161"></a>00161      actDebugTogg-&gt;setCheckable (<span class="keyword">true</span>);
<a name="l00162"></a>00162      actDebugTogg-&gt;setChecked (<span class="keyword">false</span>);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164      <span class="comment">// kill the script  </span>
<a name="l00166"></a>00166 <span class="comment"></span>     actKill = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/kill.png&quot;</span>), <span class="stringliteral">&quot;Kill&quot;</span>,<span class="keyword">this</span>);
<a name="l00167"></a>00167      actKill-&gt;setShortcut(Qt::CTRL   + Qt::Key_K);
<a name="l00168"></a>00168      actKill-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Kill the script!&quot;</span>));
<a name="l00169"></a>00169      connect(actKill, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(Kill()));
<a name="l00170"></a>00170 
<a name="l00171"></a>00171      <span class="comment">// debugger actions</span>
<a name="l00172"></a>00172      actDbgInterrupt = qsEng-&gt;debugger()-&gt;action( QScriptEngineDebugger::InterruptAction);
<a name="l00173"></a>00173      actDbgContinue = qsEng-&gt;debugger()-&gt;action(QScriptEngineDebugger::ContinueAction);
<a name="l00174"></a>00174      actDbgStepOver = qsEng-&gt;debugger()-&gt;action(QScriptEngineDebugger::StepOverAction);
<a name="l00175"></a>00175      actDbgStepInto = qsEng-&gt;debugger()-&gt;action(QScriptEngineDebugger::StepIntoAction);
<a name="l00176"></a>00176      actDbgClearConsole = qsEng-&gt;debugger()-&gt;action(QScriptEngineDebugger::ClearConsoleAction);
<a name="l00177"></a>00177      actDbgClearDebugOutput = qsEng-&gt;debugger()-&gt;action(QScriptEngineDebugger::ClearDebugOutputAction);
<a name="l00178"></a>00178      actDbgClearErrorLog = qsEng-&gt;debugger()-&gt;action(QScriptEngineDebugger::ClearErrorLogAction);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00181"></a>00181      actDbgClearDebugOutput-&gt;setShortcut(Qt::Key_F2);
<a name="l00182"></a>00182      actDbgClearConsole-&gt;setShortcut(Qt::Key_F3);
<a name="l00183"></a>00183      actDbgClearErrorLog-&gt;setShortcut(Qt::Key_F4);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185      <span class="comment">//action of show the completion list</span>
<a name="l00186"></a>00186      actCallTips = <span class="keyword">new</span> QAction(<span class="stringliteral">&quot;Call Tips&quot;</span>,<span class="keyword">this</span>);
<a name="l00187"></a>00187      actCallTips-&gt;setShortcut(Qt::CTRL + Qt::Key_Space);
<a name="l00188"></a>00188      actCallTips-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show the call tips&quot;</span>));
<a name="l00189"></a>00189      connect(actCallTips, SIGNAL(triggered()), txtSci, SLOT(autoCompleteFromAll()));
<a name="l00190"></a>00190 
<a name="l00191"></a>00191      <span class="comment">//switch the lexer between the two mode</span>
<a name="l00192"></a>00192      actLexerJSNormal = <span class="keyword">new</span> QAction(<span class="stringliteral">&quot;Normal mode&quot;</span>,<span class="keyword">this</span>);
<a name="l00193"></a>00193      connect(actLexerJSNormal, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(switchLexerNormal()));
<a name="l00194"></a>00194 
<a name="l00195"></a>00195      actLexerJSDebugComp = <span class="keyword">new</span> QAction(<span class="stringliteral">&quot;Debug compatibility mode&quot;</span>,<span class="keyword">this</span>);
<a name="l00196"></a>00196      connect(actLexerJSDebugComp, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(switchLexerDebugComp()));
<a name="l00197"></a>00197 
<a name="l00198"></a>00198      <span class="comment">//action of put a new script</span>
<a name="l00199"></a>00199      newAct = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/new.png&quot;</span>), tr(<span class="stringliteral">&quot;&amp;New&quot;</span>), <span class="keyword">this</span>);
<a name="l00200"></a>00200      newAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+N&quot;</span>));
<a name="l00201"></a>00201      newAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Create a new file&quot;</span>));
<a name="l00202"></a>00202      connect(newAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(newFile()));
<a name="l00203"></a>00203 
<a name="l00204"></a>00204      <span class="comment">//action of open a script</span>
<a name="l00205"></a>00205      openAct = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/open.png&quot;</span>), tr(<span class="stringliteral">&quot;&amp;Open...&quot;</span>), <span class="keyword">this</span>);
<a name="l00206"></a>00206      openAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+O&quot;</span>));
<a name="l00207"></a>00207      openAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Open an existing file&quot;</span>));
<a name="l00208"></a>00208      connect(openAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(open()));
<a name="l00209"></a>00209 
<a name="l00210"></a>00210      <span class="comment">//action of save a script</span>
<a name="l00211"></a>00211      saveAct = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/save.png&quot;</span>), tr(<span class="stringliteral">&quot;&amp;Save&quot;</span>), <span class="keyword">this</span>);
<a name="l00212"></a>00212      saveAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+S&quot;</span>));
<a name="l00213"></a>00213      saveAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Save the document to disk&quot;</span>));
<a name="l00214"></a>00214      connect(saveAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(save()));
<a name="l00215"></a>00215 
<a name="l00216"></a>00216      <span class="comment">//action of save as a script</span>
<a name="l00217"></a>00217      saveAsAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Save &amp;As...&quot;</span>), <span class="keyword">this</span>);
<a name="l00218"></a>00218      saveAsAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Save the document under a new name&quot;</span>));
<a name="l00219"></a>00219      connect(saveAsAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(saveAs()));
<a name="l00220"></a>00220 
<a name="l00221"></a>00221      <span class="comment">//action of close the window</span>
<a name="l00222"></a>00222      exitAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;E&amp;xit&quot;</span>), <span class="keyword">this</span>);
<a name="l00223"></a>00223      exitAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+Q&quot;</span>));
<a name="l00224"></a>00224      exitAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Exit the application&quot;</span>));
<a name="l00225"></a>00225      connect(exitAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(close()));
<a name="l00226"></a>00226 
<a name="l00227"></a>00227      <span class="comment">// action of cut</span>
<a name="l00228"></a>00228      cutAct = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/cut.png&quot;</span>), tr(<span class="stringliteral">&quot;Cu&amp;t&quot;</span>), <span class="keyword">this</span>);
<a name="l00229"></a>00229      cutAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+X&quot;</span>));
<a name="l00230"></a>00230      cutAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Cut the current selection&#39;s contents to the &quot;</span>
<a name="l00231"></a>00231           <span class="stringliteral">&quot;clipboard&quot;</span>));
<a name="l00232"></a>00232      connect(cutAct, SIGNAL(triggered()), txtSci, SLOT(cut()));
<a name="l00233"></a>00233 
<a name="l00234"></a>00234      <span class="comment">//action of copy</span>
<a name="l00235"></a>00235      copyAct = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/copy.png&quot;</span>), tr(<span class="stringliteral">&quot;&amp;Copy&quot;</span>), <span class="keyword">this</span>);
<a name="l00236"></a>00236      copyAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+C&quot;</span>));
<a name="l00237"></a>00237      copyAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Copy the current selection&#39;s contents to the &quot;</span>
<a name="l00238"></a>00238           <span class="stringliteral">&quot;clipboard&quot;</span>));
<a name="l00239"></a>00239      connect(copyAct, SIGNAL(triggered()), txtSci, SLOT(copy()));
<a name="l00240"></a>00240 
<a name="l00241"></a>00241      <span class="comment">//action of past</span>
<a name="l00242"></a>00242      pasteAct = <span class="keyword">new</span> QAction(QIcon(<span class="stringliteral">&quot;:icon/paste.png&quot;</span>), tr(<span class="stringliteral">&quot;&amp;Paste&quot;</span>), <span class="keyword">this</span>);
<a name="l00243"></a>00243      pasteAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+V&quot;</span>));
<a name="l00244"></a>00244      pasteAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Paste the clipboard&#39;s contents into the current &quot;</span>
<a name="l00245"></a>00245           <span class="stringliteral">&quot;selection&quot;</span>));
<a name="l00246"></a>00246      connect(pasteAct, SIGNAL(triggered()), txtSci, SLOT(paste()));
<a name="l00247"></a>00247 
<a name="l00248"></a>00248      <span class="comment">// show the about box</span>
<a name="l00249"></a>00249      aboutAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;About&quot;</span>), <span class="keyword">this</span>);
<a name="l00250"></a>00250      aboutAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show the application&#39;s About box&quot;</span>));
<a name="l00251"></a>00251      connect(aboutAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(about()));
<a name="l00252"></a>00252 
<a name="l00253"></a>00253      <span class="comment">//sow the about qt box</span>
<a name="l00254"></a>00254      aboutQtAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;About &amp;Qt&quot;</span>), <span class="keyword">this</span>);
<a name="l00255"></a>00255      aboutQtAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show the Qt library&#39;s About box&quot;</span>));
<a name="l00256"></a>00256      connect(aboutQtAct, SIGNAL(triggered()), qApp, SLOT(aboutQt()));
<a name="l00257"></a>00257 
<a name="l00258"></a>00258      cutAct-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l00259"></a>00259      copyAct-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261      connect(txtSci, SIGNAL(copyAvailable(<span class="keywordtype">bool</span>)),
<a name="l00262"></a>00262           cutAct, SLOT(setEnabled(<span class="keywordtype">bool</span>)));
<a name="l00263"></a>00263      connect(txtSci, SIGNAL(copyAvailable(<span class="keywordtype">bool</span>)),
<a name="l00264"></a>00264           copyAct, SLOT(setEnabled(<span class="keywordtype">bool</span>)));
<a name="l00265"></a>00265 }
<a name="l00272"></a>00272 <span class="keywordtype">void</span> SUiScriptEditor::createMenus()
<a name="l00273"></a>00273 {
<a name="l00274"></a>00274      mnuFile = menuBar()-&gt;addMenu(tr(<span class="stringliteral">&quot;&amp;File&quot;</span>));
<a name="l00275"></a>00275      mnuFile-&gt;addAction(newAct);
<a name="l00276"></a>00276      mnuFile-&gt;addAction(openAct);
<a name="l00277"></a>00277      mnuFile-&gt;addAction(saveAct);
<a name="l00278"></a>00278      mnuFile-&gt;addAction(saveAsAct);
<a name="l00279"></a>00279      mnuFile-&gt;addSeparator();
<a name="l00280"></a>00280      mnuFile-&gt;addAction(exitAct);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00284"></a>00284      mnuEdit = menuBar()-&gt;addMenu(tr(<span class="stringliteral">&quot;&amp;Edit&quot;</span>));
<a name="l00285"></a>00285      mnuEdit-&gt;addAction(cutAct);
<a name="l00286"></a>00286      mnuEdit-&gt;addAction(copyAct);
<a name="l00287"></a>00287      mnuEdit-&gt;addAction(pasteAct);
<a name="l00288"></a>00288      mnuEdit-&gt;addSeparator();
<a name="l00289"></a>00289      mnuEdit-&gt;addAction(actCallTips);
<a name="l00290"></a>00290      mnuHighlighting = mnuEdit-&gt;addMenu(<span class="stringliteral">&quot;Syntax highlighting&quot;</span>);
<a name="l00291"></a>00291      mnuHighlighting-&gt;addAction(actLexerJSNormal);
<a name="l00292"></a>00292      mnuHighlighting-&gt;addAction(actLexerJSDebugComp);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 
<a name="l00295"></a>00295      mnuScript = menuBar()-&gt;addMenu(tr(<span class="stringliteral">&quot;&amp;Script&quot;</span>));
<a name="l00296"></a>00296      mnuScript-&gt;addAction(actExecute);
<a name="l00297"></a>00297      mnuScript-&gt;addAction(actSelectedExecute);    
<a name="l00298"></a>00298      mnuScript-&gt;addAction(actDebugTogg);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300      mnuScript-&gt;addSeparator();
<a name="l00301"></a>00301      mnuScript-&gt;addAction(actKill);
<a name="l00302"></a>00302      mnuScript-&gt;addAction(actDbgInterrupt);
<a name="l00303"></a>00303      mnuScript-&gt;addAction(actDbgContinue);
<a name="l00304"></a>00304      mnuScript-&gt;addAction(actDbgStepOver) ;
<a name="l00305"></a>00305      mnuScript-&gt;addAction(actDbgStepInto);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307      mnuScript-&gt;addSeparator();
<a name="l00308"></a>00308      mnuScript-&gt;addAction(actDbgClearConsole);
<a name="l00309"></a>00309      mnuScript-&gt;addAction(actDbgClearDebugOutput);
<a name="l00310"></a>00310      mnuScript-&gt;addAction(actDbgClearErrorLog);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312      menuBar()-&gt;addSeparator();
<a name="l00313"></a>00313 
<a name="l00314"></a>00314      mnuHelp = menuBar()-&gt;addMenu(tr(<span class="stringliteral">&quot;&amp;Help&quot;</span>));
<a name="l00315"></a>00315      mnuHelp-&gt;addAction(aboutAct);
<a name="l00316"></a>00316      mnuHelp-&gt;addAction(aboutQtAct);
<a name="l00317"></a>00317 }
<a name="l00324"></a>00324 <span class="keywordtype">void</span> SUiScriptEditor::createToolBars()
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326      fileToolBar = addToolBar(tr(<span class="stringliteral">&quot;File&quot;</span>));
<a name="l00327"></a>00327      fileToolBar-&gt;addAction(newAct);
<a name="l00328"></a>00328      fileToolBar-&gt;addAction(openAct);
<a name="l00329"></a>00329      fileToolBar-&gt;addAction(saveAct);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331      editToolBar = addToolBar(tr(<span class="stringliteral">&quot;Edit&quot;</span>));
<a name="l00332"></a>00332      editToolBar-&gt;addAction(cutAct);
<a name="l00333"></a>00333      editToolBar-&gt;addAction(copyAct);
<a name="l00334"></a>00334      editToolBar-&gt;addAction(pasteAct);
<a name="l00335"></a>00335 
<a name="l00336"></a>00336      scriptToolBar = addToolBar(tr(<span class="stringliteral">&quot;Script&quot;</span>));
<a name="l00337"></a>00337      scriptToolBar-&gt;addAction(actExecute);
<a name="l00338"></a>00338      scriptToolBar-&gt;addAction(actDebugTogg);
<a name="l00339"></a>00339      scriptToolBar-&gt;addSeparator(); <span class="comment">//----</span>
<a name="l00340"></a>00340      scriptToolBar-&gt;addAction(actKill);
<a name="l00341"></a>00341      scriptToolBar-&gt;addAction(actDbgInterrupt);
<a name="l00342"></a>00342      scriptToolBar-&gt;addAction(actDbgContinue);
<a name="l00343"></a>00343      scriptToolBar-&gt;addAction(actDbgStepOver);
<a name="l00344"></a>00344      scriptToolBar-&gt;addAction(actDbgStepInto);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 <span class="keywordtype">void</span> SUiScriptEditor::createStatusBar()
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352      statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready&quot;</span>));
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keywordtype">void</span> SUiScriptEditor::readSettings(){
<a name="l00356"></a>00356 
<a name="l00357"></a>00357      QSettings settings(QSettings::NativeFormat,QSettings::UserScope, <span class="stringliteral">&quot;Spintec&quot;</span>, <span class="stringliteral">&quot;SpinToolBox&quot;</span>);
<a name="l00358"></a>00358      QPoint pos = settings.value(<span class="stringliteral">&quot;pos&quot;</span>, QPoint(200, 200)).toPoint();
<a name="l00359"></a>00359      QSize size = settings.value(<span class="stringliteral">&quot;size&quot;</span>, QSize(700, 600)).toSize();
<a name="l00360"></a>00360      resize(size);
<a name="l00361"></a>00361      move(pos);
<a name="l00362"></a>00362      splitter-&gt;restoreState(settings.value(<span class="stringliteral">&quot;splitterSizes&quot;</span>).toByteArray());
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="keywordtype">void</span> SUiScriptEditor::writeSettings()
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367      QSettings settings(QSettings::IniFormat,QSettings::UserScope, <span class="stringliteral">&quot;Spintec&quot;</span>, <span class="stringliteral">&quot;SpinToolBox&quot;</span>);
<a name="l00368"></a>00368      settings.setValue(<span class="stringliteral">&quot;pos&quot;</span>, pos());
<a name="l00369"></a>00369      settings.setValue(<span class="stringliteral">&quot;size&quot;</span>, size());
<a name="l00370"></a>00370      settings.setValue(<span class="stringliteral">&quot;ScriptEditorSplitterSizes&quot;</span>, splitter-&gt;saveState());
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 }
<a name="l00379"></a>00379 <span class="keywordtype">bool</span> SUiScriptEditor::maybeSave()
<a name="l00380"></a>00380 {
<a name="l00381"></a>00381      <span class="keywordflow">if</span> (txtSci-&gt;isModified()) {
<a name="l00382"></a>00382           <span class="keywordtype">int</span> ret = QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;SpinToolBox&quot;</span>),
<a name="l00383"></a>00383                tr(<span class="stringliteral">&quot;The script has been modified.\n&quot;</span>
<a name="l00384"></a>00384                <span class="stringliteral">&quot;Do you want to save your changes?&quot;</span>),
<a name="l00385"></a>00385                QMessageBox::Yes | QMessageBox::Default,
<a name="l00386"></a>00386                QMessageBox::No,
<a name="l00387"></a>00387                QMessageBox::Cancel | QMessageBox::Escape);
<a name="l00388"></a>00388           <span class="keywordflow">if</span> (ret == QMessageBox::Yes)
<a name="l00389"></a>00389                <span class="keywordflow">return</span> save();
<a name="l00390"></a>00390           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret == QMessageBox::Cancel)
<a name="l00391"></a>00391                <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00392"></a>00392      }
<a name="l00393"></a>00393      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00394"></a>00394 }
<a name="l00401"></a>00401 <span class="keywordtype">void</span> SUiScriptEditor::loadFile(<span class="keyword">const</span> QString &amp;fileName)
<a name="l00402"></a>00402 {
<a name="l00403"></a>00403      QFile file(fileName);
<a name="l00404"></a>00404      <span class="keywordflow">if</span> (!file.open(QFile::ReadOnly)) {
<a name="l00405"></a>00405           QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;SpinToolBox&quot;</span>),
<a name="l00406"></a>00406                tr(<span class="stringliteral">&quot;Cannot read file %1:\n%2.&quot;</span>)
<a name="l00407"></a>00407                .arg(fileName)
<a name="l00408"></a>00408                .arg(file.errorString()));
<a name="l00409"></a>00409           <span class="keywordflow">return</span>;
<a name="l00410"></a>00410      }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412      QTextStream in(&amp;file);
<a name="l00413"></a>00413      QApplication::setOverrideCursor(Qt::WaitCursor);
<a name="l00414"></a>00414      txtSci-&gt;setText(in.readAll());
<a name="l00415"></a>00415      QApplication::restoreOverrideCursor();
<a name="l00416"></a>00416 
<a name="l00417"></a>00417      setCurrentFile(fileName);
<a name="l00418"></a>00418      statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;File loaded&quot;</span>), 2000);
<a name="l00419"></a>00419 }
<a name="l00426"></a>00426 <span class="keywordtype">bool</span> SUiScriptEditor::saveFile(<span class="keyword">const</span> QString &amp;fileName)
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428      QFile file(fileName);
<a name="l00429"></a>00429      <span class="keywordflow">if</span> (!file.open(QFile::WriteOnly)) {
<a name="l00430"></a>00430           QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;SpinToolBox&quot;</span>),
<a name="l00431"></a>00431                tr(<span class="stringliteral">&quot;Cannot write file %1:\n%2.&quot;</span>)
<a name="l00432"></a>00432                .arg(fileName)
<a name="l00433"></a>00433                .arg(file.errorString()));
<a name="l00434"></a>00434           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00435"></a>00435      }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437      QTextStream out(&amp;file);
<a name="l00438"></a>00438      QApplication::setOverrideCursor(Qt::WaitCursor);
<a name="l00439"></a>00439      out &lt;&lt; txtSci-&gt;text();
<a name="l00440"></a>00440      QApplication::restoreOverrideCursor();
<a name="l00441"></a>00441 
<a name="l00442"></a>00442      setCurrentFile(fileName);
<a name="l00443"></a>00443      statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;File saved&quot;</span>), 2000);
<a name="l00444"></a>00444      <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00453"></a>00453 <span class="keywordtype">void</span> SUiScriptEditor::setCurrentFile(<span class="keyword">const</span> QString &amp;fileName)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455      curFile = fileName;
<a name="l00456"></a>00456      txtSci-&gt;setModified(<span class="keyword">false</span>);
<a name="l00457"></a>00457      setWindowModified(<span class="keyword">false</span>);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459      QString shownName;
<a name="l00460"></a>00460      <span class="keywordflow">if</span> (curFile.isEmpty())
<a name="l00461"></a>00461           shownName = <span class="stringliteral">&quot;untitled.js&quot;</span>;
<a name="l00462"></a>00462      <span class="keywordflow">else</span>
<a name="l00463"></a>00463           shownName = strippedName(curFile);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465      setWindowTitle(tr(<span class="stringliteral">&quot;%1[*] - %2&quot;</span>).arg(shownName).arg(tr(<span class="stringliteral">&quot;SpinToolBox&quot;</span>)));
<a name="l00466"></a>00466 }
<a name="l00473"></a>00473 QString SUiScriptEditor::strippedName(<span class="keyword">const</span> QString &amp;fullFileName)
<a name="l00474"></a>00474 {
<a name="l00475"></a>00475      <span class="keywordflow">return</span> QFileInfo(fullFileName).fileName();
<a name="l00476"></a>00476 }
<a name="l00484"></a>00484 <span class="keywordtype">void</span> SUiScriptEditor::execute(){
<a name="l00485"></a>00485 
<a name="l00486"></a>00486      emit run(txtSci-&gt;text(),curFile,1 , actDebugTogg-&gt;isChecked ());
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00496"></a>00496 <span class="keywordtype">void</span> SUiScriptEditor::alreadyRun(){
<a name="l00497"></a>00497      statusBar()-&gt;showMessage(<span class="stringliteral">&quot;Only on script can be execute at once&quot;</span>,1000);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 }
<a name="l00506"></a>00506 <span class="keywordtype">void</span> SUiScriptEditor::swichToDebugMode(){
<a name="l00507"></a>00507      stkText-&gt;setCurrentIndex(1);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 }
<a name="l00516"></a>00516 <span class="keywordtype">void</span> SUiScriptEditor::swichToEditMode(){
<a name="l00517"></a>00517      stkText-&gt;setCurrentIndex(0);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00527"></a>00527 <span class="keywordtype">void</span> SUiScriptEditor::createScintilla(){
<a name="l00528"></a>00528 
<a name="l00529"></a>00529      txtSci-&gt;setUtf8(<span class="keyword">true</span>); <span class="comment">// encodage en UTF8</span>
<a name="l00530"></a>00530 
<a name="l00531"></a>00531      txtSci-&gt;setMarginLineNumbers(1, <span class="keyword">true</span>); <span class="comment">// numérotation des lignes</span>
<a name="l00532"></a>00532      txtSci-&gt;setMarginWidth(1, 35); <span class="comment">// agrandissement de la marge</span>
<a name="l00533"></a>00533      txtSci-&gt;setAutoIndent(<span class="keyword">true</span>);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535      <span class="comment">//we have tow lexer, in function of wich on the user prefers</span>
<a name="l00536"></a>00536      lexerJSNormal = <span class="keyword">new</span> QsciLexerJavaScript; <span class="comment">// création du lexer</span>
<a name="l00537"></a>00537      lexerJSDebugComp = <span class="keyword">new</span> QsciLexerJavaScript; <span class="comment">// création du lexer</span>
<a name="l00538"></a>00538 
<a name="l00539"></a>00539      txtSci-&gt;setLexer(lexerJSNormal); <span class="comment">// application du lexer au QsciScintilla</span>
<a name="l00540"></a>00540 
<a name="l00541"></a>00541      QsciAPIs *api = <span class="keyword">new</span> QsciAPIs(lexerJSNormal); <span class="comment">// déclaration de l&#39;api</span>
<a name="l00542"></a>00542 
<a name="l00543"></a>00543      api-&gt;load(QApplication::applicationDirPath() + <span class="stringliteral">&quot;/AutoCompletion.api&quot;</span>); <span class="comment">// chargement du fichier texte</span>
<a name="l00544"></a>00544      api-&gt;prepare(); <span class="comment">// préparation  de l&#39;auto-completion</span>
<a name="l00545"></a>00545      lexerJSNormal-&gt;setAPIs(api); <span class="comment">// application de l&#39;api au lexer</span>
<a name="l00546"></a>00546 
<a name="l00547"></a>00547      txtSci-&gt;setAutoCompletionSource(QsciScintilla::AcsAPIs); <span class="comment">// application de l&#39;auto-completion à la zone de texte</span>
<a name="l00548"></a>00548      txtSci-&gt;setAutoCompletionThreshold(2); <span class="comment">// la liste sera affichée au bout de 1 caractère</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550      QStringList sep;
<a name="l00551"></a>00551      sep &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>&lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;
<a name="l00552"></a>00552      txtSci-&gt;setAutoCompletionWordSeparators(sep);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a>00555      txtSci-&gt;setAutoCompletionFillupsEnabled(<span class="keyword">true</span>);
<a name="l00556"></a>00556      txtSci-&gt;setCallTipsStyle(QsciScintilla::CallTipsContext)  ;
<a name="l00557"></a>00557      txtSci-&gt;setFolding(QsciScintilla::BoxedFoldStyle, 2);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 }
<a name="l00566"></a>00566 <span class="keywordtype">void</span> SUiScriptEditor::switchLexerNormal()
<a name="l00567"></a>00567 {
<a name="l00568"></a>00568      txtSci-&gt;setLexer(lexerJSNormal);
<a name="l00569"></a>00569 }
<a name="l00576"></a>00576 <span class="keywordtype">void</span> SUiScriptEditor::switchLexerDebugComp()
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578      <span class="keywordflow">if</span>(lexerJSDebugComp == NULL){
<a name="l00579"></a>00579 
<a name="l00580"></a>00580           QsciAPIs *api = <span class="keyword">new</span> QsciAPIs(lexerJSDebugComp); <span class="comment">// déclaration de l&#39;api</span>
<a name="l00581"></a>00581 
<a name="l00582"></a>00582           api-&gt;load(QApplication::applicationDirPath() + <span class="stringliteral">&quot;/AutoCompletion.api&quot;</span>); <span class="comment">// chargement du fichier texte</span>
<a name="l00583"></a>00583           api-&gt;prepare(); <span class="comment">// préparation  de l&#39;auto-completion</span>
<a name="l00584"></a>00584 
<a name="l00585"></a>00585           lexerJSDebugComp-&gt;setAPIs(api);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587           <span class="comment">// set the fonts and colors</span>
<a name="l00588"></a>00588           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerJavaScript::Default );
<a name="l00589"></a>00589           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerJavaScript::Operator );
<a name="l00590"></a>00590 
<a name="l00591"></a>00591           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerJavaScript::Identifier );
<a name="l00592"></a>00592 
<a name="l00593"></a>00593           lexerJSDebugComp-&gt;setColor(Qt::darkGreen, QsciLexerCPP::DoubleQuotedString );
<a name="l00594"></a>00594           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerCPP::DoubleQuotedString );
<a name="l00595"></a>00595 
<a name="l00596"></a>00596           lexerJSDebugComp-&gt;setColor(Qt::darkGreen, QsciLexerCPP::SingleQuotedString  );
<a name="l00597"></a>00597           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerCPP::SingleQuotedString );
<a name="l00598"></a>00598 
<a name="l00599"></a>00599           lexerJSDebugComp-&gt;setColor(Qt::darkBlue, QsciLexerCPP::Number );
<a name="l00600"></a>00600           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerCPP::Number );
<a name="l00601"></a>00601 
<a name="l00602"></a>00602           lexerJSDebugComp-&gt;setColor(Qt::darkYellow, QsciLexerCPP::Keyword  );
<a name="l00603"></a>00603           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerCPP::Keyword );
<a name="l00604"></a>00604 
<a name="l00605"></a>00605           lexerJSDebugComp-&gt;setColor(Qt::darkBlue, QsciLexerCPP::PreProcessor  );
<a name="l00606"></a>00606           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleNormal), QsciLexerCPP::PreProcessor );
<a name="l00607"></a>00607 
<a name="l00608"></a>00608           lexerJSDebugComp-&gt;setColor(Qt::darkGreen, QsciLexerCPP::Comment );
<a name="l00609"></a>00609           lexerJSDebugComp-&gt;setColor(Qt::darkGreen, QsciLexerCPP::CommentLine ); 
<a name="l00610"></a>00610           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleItalic), QsciLexerCPP::Comment );
<a name="l00611"></a>00611           lexerJSDebugComp-&gt;setFont(QFont(<span class="stringliteral">&quot;Times&quot;</span>, 10, QFont::StyleItalic), QsciLexerCPP::CommentLine ); 
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 
<a name="l00614"></a>00614      }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616      txtSci-&gt;setLexer(lexerJSDebugComp);
<a name="l00617"></a>00617 }
<a name="l00624"></a>00624 <span class="keywordtype">void</span> SUiScriptEditor::setupUI(){
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 
<a name="l00627"></a>00627      <span class="comment">//a layout for organize the space</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629      splitter = <span class="keyword">new</span> QSplitter();
<a name="l00630"></a>00630      splitter-&gt;setOrientation(Qt::Vertical);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632      <span class="comment">//Widget from the debugger</span>
<a name="l00633"></a>00633      wdgDbgText = (qsEng-&gt;debugger()-&gt;widget(QScriptEngineDebugger::CodeWidget));
<a name="l00634"></a>00634      wdgDbgOutput = (qsEng-&gt;debugger()-&gt;widget(QScriptEngineDebugger::DebugOutputWidget));
<a name="l00635"></a>00635      wdgDbgOutput-&gt;setMaximumHeight (500);
<a name="l00636"></a>00636      wdgDbgConsole = (qsEng-&gt;debugger()-&gt;widget(QScriptEngineDebugger::ConsoleWidget));
<a name="l00637"></a>00637      wdgDbgConsole-&gt;setMaximumHeight (500);
<a name="l00638"></a>00638      wdgDbgErrorLog = (qsEng-&gt;debugger()-&gt;widget(QScriptEngineDebugger::ErrorLogWidget)); 
<a name="l00639"></a>00639      wdgDbgErrorLog-&gt;setMaximumHeight (500);
<a name="l00640"></a>00640      wdgDbgLocals = (qsEng-&gt;debugger()-&gt;widget(QScriptEngineDebugger::LocalsWidget)); 
<a name="l00641"></a>00641      wdgDbgLocals-&gt;setMaximumHeight (500);
<a name="l00642"></a>00642      wdgDbgStack = (qsEng-&gt;debugger()-&gt;widget(QScriptEngineDebugger::StackWidget)); 
<a name="l00643"></a>00643      wdgDbgStack-&gt;setMaximumHeight (500);
<a name="l00644"></a>00644      wdgDbgBreakpoints = (qsEng-&gt;debugger()-&gt;widget(QScriptEngineDebugger::BreakpointsWidget)); 
<a name="l00645"></a>00645      wdgDbgBreakpoints-&gt;setMaximumHeight (500);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647      <span class="comment">//we can switch between Scintilla and CodeWidget, so we put a QStackedLayout</span>
<a name="l00648"></a>00648      stkText = <span class="keyword">new</span> QStackedLayout(splitter);
<a name="l00649"></a>00649      stkText-&gt;addWidget(txtSci);
<a name="l00650"></a>00650      stkText-&gt;addWidget(wdgDbgText);
<a name="l00651"></a>00651      QWidget* textWidget = <span class="keyword">new</span> QWidget(<span class="keyword">this</span>);
<a name="l00652"></a>00652      textWidget-&gt;setLayout(stkText);
<a name="l00653"></a>00653      splitter-&gt;addWidget(textWidget);
<a name="l00654"></a>00654      splitter-&gt;setCollapsible(splitter-&gt;indexOf(textWidget) ,<span class="keyword">false</span>);
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 
<a name="l00657"></a>00657      <span class="comment">//we can switch between the ConsoleWidget and the DebugOutputWidget, hear we put a tabwidget   </span>
<a name="l00658"></a>00658      tabDbg = <span class="keyword">new</span> QTabWidget(splitter);
<a name="l00659"></a>00659      tabDbg-&gt;setMovable(<span class="keyword">true</span>);
<a name="l00660"></a>00660      tabDbg-&gt;setTabShape(QTabWidget::Rounded);
<a name="l00661"></a>00661      tabDbg-&gt;setDocumentMode(<span class="keyword">true</span>);
<a name="l00662"></a>00662      tabDbg-&gt;addTab(wdgDbgConsole, QString(<span class="stringliteral">&quot;Console&quot;</span>));
<a name="l00663"></a>00663      tabDbg-&gt;addTab(wdgDbgOutput, QString(<span class="stringliteral">&quot;Output&quot;</span>));
<a name="l00664"></a>00664      tabDbg-&gt;addTab(wdgDbgErrorLog, QString(<span class="stringliteral">&quot;Error Log&quot;</span>));
<a name="l00665"></a>00665      tabDbg-&gt;addTab(wdgDbgLocals, QString(<span class="stringliteral">&quot;Locals&quot;</span>));
<a name="l00666"></a>00666      tabDbg-&gt;addTab(wdgDbgStack, QString(<span class="stringliteral">&quot;Stack&quot;</span>));
<a name="l00667"></a>00667      tabDbg-&gt;addTab(wdgDbgBreakpoints, QString(<span class="stringliteral">&quot;Breakpoints&quot;</span>));
<a name="l00668"></a>00668      tabDbg-&gt;setMaximumHeight (500);
<a name="l00669"></a>00669      splitter-&gt;addWidget(tabDbg);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671      QList&lt;int&gt; list;
<a name="l00672"></a>00672      list.append(500);
<a name="l00673"></a>00673      list.append(200);
<a name="l00674"></a>00674      splitter-&gt;setSizes ( list  );
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 
<a name="l00677"></a>00677      <span class="comment">//we put all in the main windows</span>
<a name="l00678"></a>00678      this-&gt;setCentralWidget(splitter);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680      connect(txtSci, SIGNAL(textChanged()),
<a name="l00681"></a>00681           <span class="keyword">this</span>, SLOT(documentWasModified()));
<a name="l00682"></a>00682 
<a name="l00683"></a>00683      connect(tabDbg, SIGNAL(currentChanged(<span class="keywordtype">int</span>)),
<a name="l00684"></a>00684           <span class="keyword">this</span>, SLOT(tabDbgCurrentChanged(<span class="keywordtype">int</span>)));
<a name="l00685"></a>00685 
<a name="l00686"></a>00686      <span class="comment">//we put an icon</span>
<a name="l00687"></a>00687      QIcon icon;
<a name="l00688"></a>00688      icon.addFile(QString::fromUtf8(<span class="stringliteral">&quot;:/compass.ico&quot;</span>), QSize(), QIcon::Normal, QIcon::Off);
<a name="l00689"></a>00689      this-&gt;setWindowIcon(icon);
<a name="l00690"></a>00690      
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 }
<a name="l00699"></a>00699 <span class="keywordtype">void</span> SUiScriptEditor::onFocus(QWidget * old, QWidget * now){
<a name="l00700"></a>00700 
<a name="l00701"></a>00701      <span class="keywordflow">if</span>(now == txtSci){
<a name="l00702"></a>00702           <span class="keyword">auto</span>  state = splitter-&gt;saveState();
<a name="l00703"></a>00703 
<a name="l00704"></a>00704           tabDbg-&gt;clear ();
<a name="l00705"></a>00705           tabDbg-&gt;addTab(wdgDbgConsole, QString(<span class="stringliteral">&quot;Console&quot;</span>));
<a name="l00706"></a>00706           tabDbg-&gt;addTab(wdgDbgOutput, QString(<span class="stringliteral">&quot;Output&quot;</span>));
<a name="l00707"></a>00707           tabDbg-&gt;addTab(wdgDbgErrorLog, QString(<span class="stringliteral">&quot;Error Log&quot;</span>));
<a name="l00708"></a>00708           tabDbg-&gt;addTab(wdgDbgLocals, QString(<span class="stringliteral">&quot;Locals&quot;</span>));
<a name="l00709"></a>00709           tabDbg-&gt;addTab(wdgDbgStack, QString(<span class="stringliteral">&quot;Stack&quot;</span>));
<a name="l00710"></a>00710           tabDbg-&gt;addTab(wdgDbgBreakpoints, QString(<span class="stringliteral">&quot;Breakpoints&quot;</span>));
<a name="l00711"></a>00711           tabDbg-&gt;setCurrentIndex(tabDbgCurrentTab);
<a name="l00712"></a>00712           tabDbg-&gt;setMaximumHeight (500);
<a name="l00713"></a>00713 
<a name="l00714"></a>00714           stkText-&gt;removeWidget(wdgDbgText);
<a name="l00715"></a>00715           stkText-&gt;addWidget(wdgDbgText);
<a name="l00716"></a>00716           splitter-&gt;restoreState(state);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718      }
<a name="l00719"></a>00719 }
<a name="l00726"></a>00726 <span class="keywordtype">void</span> SUiScriptEditor::Kill()
<a name="l00727"></a>00727 {
<a name="l00728"></a>00728      <span class="keywordflow">if</span> (!qsEng-&gt;isEvaluating()){
<a name="l00729"></a>00729           <span class="keywordflow">return</span>;
<a name="l00730"></a>00730      }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732      <span class="keywordtype">int</span> ret = QMessageBox::question(<span class="keyword">this</span>, <span class="stringliteral">&quot;SpintToolBox&quot;</span>,
<a name="l00733"></a>00733           <span class="stringliteral">&quot;This action will stop the script, do you really want do this?&quot;</span>, 
<a name="l00734"></a>00734           QMessageBox::Yes,QMessageBox::No);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736      <span class="keywordflow">if</span>(ret == QMessageBox::No){
<a name="l00737"></a>00737           <span class="comment">//no so goodbye!</span>
<a name="l00738"></a>00738           <span class="keywordflow">return</span>;
<a name="l00739"></a>00739      }<span class="keywordflow">else</span>{
<a name="l00740"></a>00740 
<a name="l00741"></a>00741           ;<span class="comment">//we do a loop, because the script engine is not really multi thread, </span>
<a name="l00742"></a>00742           <span class="comment">// so if it is running a native C++ function, it does not execute the abortEvaluation, </span>
<a name="l00743"></a>00743           <span class="comment">// so we &quot;wait&quot; until it can do it.</span>
<a name="l00744"></a>00744           <span class="keywordtype">int</span> i =0;
<a name="l00745"></a>00745           clock_t start1,end1;
<a name="l00746"></a>00746           clock_t start2,end2;
<a name="l00747"></a>00747           actExecute-&gt;setDisabled(<span class="keyword">true</span>);
<a name="l00748"></a>00748           statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;You cannot run a new script before 5 seconds&quot;</span>), 2000);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 
<a name="l00751"></a>00751                     start1=clock();
<a name="l00752"></a>00752                     <span class="keywordflow">while</span>(((end1=clock())-start1)&lt;=5*CLOCKS_PER_SEC){
<a name="l00753"></a>00753                          qsEng-&gt;abortEvaluation();
<a name="l00754"></a>00754                          
<a name="l00755"></a>00755                          <span class="keywordflow">while</span>(((end1=clock())-start1)&lt;=0.5*CLOCKS_PER_SEC){                        
<a name="l00756"></a>00756                               QCoreApplication::processEvents ();
<a name="l00757"></a>00757                          }
<a name="l00758"></a>00758                     }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 
<a name="l00761"></a>00761           actExecute-&gt;setEnabled(<span class="keyword">true</span>);
<a name="l00762"></a>00762           swichToEditMode();
<a name="l00763"></a>00763      }
<a name="l00764"></a>00764 }
<a name="l00771"></a>00771 <span class="keywordtype">void</span> SUiScriptEditor::tabDbgCurrentChanged( <span class="keywordtype">int</span> index )
<a name="l00772"></a>00772 {
<a name="l00773"></a>00773      <span class="keywordflow">if</span>(index != -1 &amp;&amp; tabDbg-&gt;count()==6 ){
<a name="l00774"></a>00774           tabDbgCurrentTab = index;
<a name="l00775"></a>00775      }
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 
<a name="l00786"></a>00786 <span class="keywordtype">void</span> SUiScriptEditor::executeSelectedText(){
<a name="l00787"></a>00787      <span class="keywordflow">if</span>(txtSci-&gt;hasSelectedText()){
<a name="l00788"></a>00788           emit run(txtSci-&gt;selectedText(),curFile,1 , actDebugTogg-&gt;isChecked ());
<a name="l00789"></a>00789      }
<a name="l00790"></a>00790 }
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 20:03:30 for SpinToolBox by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
